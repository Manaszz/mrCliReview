<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# –í–æ–∑–º–æ–∂–Ω–æ –ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, —á—Ç–æ–± self-hoted n8n  –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É–ø—Ä–∞–≤–ª—è–ª  CLI –∫–æ–¥ –∞–≥–µ–Ω—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä,  qwen code). –í–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã —Ç–µ—Ä–º–∏–Ω–∞–ª–∞.  –ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞—á–∏ - n8n –∞–≥–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç CLI –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–î–∞, —ç—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ–º–æ! n8n –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, –≤–∫–ª—é—á–∞—è code-–∞–≥–µ–Ω—Ç—ã —Ç–∏–ø–∞ Qwen Code. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤:

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. **Execute Command Node (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)**

n8n –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —É–∑–µ–ª **Execute Command**, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```javascript
// –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Qwen Code CLI
qwen-code analyze --repo /path/to/repo --output json
```


### 2. **SSH Node (–¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤)**

–ï—Å–ª–∏ Qwen Code —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ:

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH —É–∑–µ–ª –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ –∫–ª—é—á–∞–º


### 3. **Docker —á–µ—Ä–µ–∑ CLI**

–ï—Å–ª–∏ Qwen Code –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
docker exec qwen-container qwen-code analyze --repo /path/to/repo
```


## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   n8n       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Execute     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Qwen Code  ‚îÇ
‚îÇ  Workflow   ‚îÇ      ‚îÇ  Command     ‚îÇ      ‚îÇ  CLI Agent  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ                     ‚îÇ                      ‚îÇ
      ‚îÇ                     ‚ñº                      ‚ñº
      ‚îÇ              Shell Script           Analyze Repo
      ‚îÇ                                           ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    Process Results
```


## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä workflow

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ CLI

**–£–∑–ª—ã workflow:**

1. **Trigger** (Webhook/Schedule)
2. **Execute Command** - –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
3. **Process Output** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
4. **Send Results** (Email/Slack/Database)

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Execute Command:**

```json
{
  "command": "qwen-code analyze",
  "arguments": [
    "--repo", "={{$json.repo_path}}",
    "--format", "json",
    "--depth", "full"
  ],
  "workingDirectory": "/home/n8n/repos"
}
```


### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç (–±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è)

**Execute Command —É–∑–µ–ª:**

```python
#!/usr/bin/env python3
import subprocess
import json
import sys

repo_path = sys.argv[1]

# –ó–∞–ø—É—Å–∫ Qwen Code
result = subprocess.run(
    ['qwen-code', 'analyze', '--repo', repo_path, '--format', 'json'],
    capture_output=True,
    text=True
)

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è n8n
print(result.stdout)
```


## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MCP —Å–µ—Ä–≤–µ—Ä–∞–º–∏

–£—á–∏—Ç—ã–≤–∞—è –≤–∞—à –æ–ø—ã—Ç —Å MCP, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å **MCP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è Qwen Code**:

```typescript
// mcp-qwen-code-server
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  if (request.params.name === "analyze_repository") {
    const { repo_path, options } = request.params.arguments;
    
    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ CLI –∫–æ–º–∞–Ω–¥—ã
    const result = await execPromise(
      `qwen-code analyze --repo ${repo_path} ${options}`
    );
    
    return {
      content: [{
        type: "text",
        text: JSON.stringify(result)
      }]
    };
  }
});
```

–ó–∞—Ç–µ–º –≤ n8n –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP Request –¥–ª—è –≤—ã–∑–æ–≤–∞ MCP —Å–µ—Ä–≤–µ—Ä–∞.

## –†–∞–±–æ—Ç–∞ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```bash
# –í Execute Command —É–∑–ª–µ
git clone {{$json.repo_url}} /tmp/repos/{{$json.repo_name}}
cd /tmp/repos/{{$json.repo_name}}
qwen-code analyze --output /tmp/results/{{$json.repo_name}}.json
```


### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ n8n:

```javascript
// –í Code —É–∑–µ–ª –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
const analysisResult = JSON.parse($input.first().json.stdout);

return {
  repository: analysisResult.repo_name,
  files_analyzed: analysisResult.file_count,
  issues: analysisResult.issues,
  complexity: analysisResult.metrics.complexity,
  suggestions: analysisResult.suggestions
};
```


## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ best practices

1. **–ò–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ Docker:**
```dockerfile
# Dockerfile –¥–ª—è Qwen Code
FROM python:3.11-slim
RUN pip install qwen-code-cli
WORKDIR /workspace
ENTRYPOINT ["qwen-code"]
```

2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤:**

- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ n8n –∏ CLI-–∞–≥–µ–Ω—Ç –ø–æ–¥ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sudo` —Å whitelist –∫–æ–º–∞–Ω–¥

3. **Timeout –∏ resource limits:**
```json
{
  "timeout": 300000,  // 5 –º–∏–Ω—É—Ç
  "maxBuffer": 10485760  // 10MB
}
```


## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. **API –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è Qwen Code**

–°–æ–∑–¥–∞–π—Ç–µ FastAPI —Å–µ—Ä–≤–µ—Ä:

```python
from fastapi import FastAPI
import subprocess

app = FastAPI()

@app.post("/analyze")
async def analyze_repo(repo_path: str):
    result = subprocess.run(
        ['qwen-code', 'analyze', '--repo', repo_path],
        capture_output=True
    )
    return {"result": result.stdout}
```

–ó–∞—Ç–µ–º –≤ n8n –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTP Request —É–∑–µ–ª.

### 2. **n8n Community Node**

–ú–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å custom node –¥–ª—è Qwen Code —Å UI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

## –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ workflow

```
1. Webhook Trigger (POST /analyze-repo)
   ‚Üì
2. Set Variables (repo_url, branch, options)
   ‚Üì
3. Execute Command: git clone
   ‚Üì
4. Execute Command: qwen-code analyze
   ‚Üì
5. Code: Parse JSON output
   ‚Üì
6. IF Node: Check for issues
   ‚îú‚îÄ Yes ‚Üí Slack notification
   ‚îî‚îÄ No ‚Üí Continue
   ‚Üì
7. PostgreSQL: Save results
   ‚Üì
8. Execute Command: Cleanup temp files
```

–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–¥ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏. –ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ - —á–µ—Ä–µ–∑ Execute Command, Docker, –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è Qwen Code?

---

# –ò–Ω—Ç–µ—Ä–µ—Å–µ–Ω execute  command. –ù–æ —É –Ω–∞—Å –∫–æ–º–∞–Ω–¥—ã –∏–∑ n8n –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ n8n, –∫–æ—Ç–æ—Ä—ã–π –≤ –∫—É–±–µ—Ä–Ω–µ—Ç–µ. –í–µ—Ä–æ—è—Ç–Ω–æ, –¥–æ–∫–µ—Ä –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞–±–æ—á–∏–π. –£—Ç–æ—á–Ω–∏, –∫–∞–∫ –¥–ª—è —Ç–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å cli qwen code, –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π.

–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä  –¥–ª—è n8n –∞–≥–µ–Ω—Ç–∞.
–ó–∞–¥–∞—á–∞ - —á—Ç–æ–±  cli  –≤—ã–ø–æ–ª–Ω–∏–ª MR review: 1)–ø—Ä–æ–≤–µ—Ä–∏–ª –∫–æ–¥ –Ω–∞ –æ—à–∏–±–∫–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ best —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∏ best practice , 2)  –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –∫–ª–∞—Å—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∑–∞—Ç—Ä–æ–Ω—É—Ç –≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö, –ø—Ä–µ–¥–ª–æ–∂–∏–ª –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É–ª—É—á—à–∞—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞. 3) –î–æ–±–∞–≤–∏–ª –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤–∏–∂—É –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É. Qwen Code CLI —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ OpenAI-compatible API, –∑–Ω–∞—á–∏—Ç –Ω—É–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –º–æ–¥–µ–ª—å –ª–æ–∫–∞–ª—å–Ω–æ. –í–æ—Ç –ø–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏:

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   n8n (K8s)     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  MCP Server      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Qwen3-Coder    ‚îÇ
‚îÇ   Workflow      ‚îÇ HTTP‚îÇ  (Node.js)       ‚îÇ API ‚îÇ  (vLLM/Ollama)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ                            ‚îÇ
                              ‚ñº                            ‚ñº
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ  Qwen Code   ‚îÇ           ‚îÇ Local Model ‚îÇ
                        ‚îÇ  CLI Engine  ‚îÇ           ‚îÇ INT4/GGUF   ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ  GitLab API  ‚îÇ
                        ‚îÇ  MR Comments ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```


## –®–∞–≥ 1: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Qwen3-Coder –º–æ–¥–µ–ª–∏ (self-hosted)

### –í–∞—Ä–∏–∞–Ω—Ç –ê: vLLM (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

**Dockerfile –¥–ª—è vLLM —Å–µ—Ä–≤–∏—Å–∞:**

```dockerfile
FROM vllm/vllm-openai:latest

ENV MODEL_NAME="Qwen/Qwen3-Coder-14B-Instruct-GPTQ-Int4"
ENV TENSOR_PARALLEL_SIZE=1
ENV GPU_MEMORY_UTILIZATION=0.9

CMD ["--model", "${MODEL_NAME}", \
     "--host", "0.0.0.0", \
     "--port", "8000", \
     "--dtype", "auto", \
     "--max-model-len", "32768", \
     "--gpu-memory-utilization", "${GPU_MEMORY_UTILIZATION}"]
```

**Kubernetes deployment:**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: qwen-coder-vllm
  namespace: ai-services
spec:
  replicas: 1
  selector:
    matchLabels:
      app: qwen-coder
  template:
    metadata:
      labels:
        app: qwen-coder
    spec:
      containers:
      - name: vllm
        image: vllm/vllm-openai:latest
        command:
          - python3
          - -m
          - vllm.entrypoints.openai.api_server
          - --model
          - Qwen/Qwen3-Coder-14B-Instruct-GPTQ-Int4
          - --host
          - 0.0.0.0
          - --port
          - "8000"
          - --max-model-len
          - "32768"
          - --dtype
          - auto
        ports:
        - containerPort: 8000
          name: http
        resources:
          limits:
            nvidia.com/gpu: 1
            memory: 32Gi
          requests:
            nvidia.com/gpu: 1
            memory: 16Gi
        volumeMounts:
        - name: model-cache
          mountPath: /root/.cache/huggingface
      volumes:
      - name: model-cache
        persistentVolumeClaim:
          claimName: huggingface-models-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: qwen-coder-api
  namespace: ai-services
spec:
  selector:
    app: qwen-coder
  ports:
  - port: 8000
    targetPort: 8000
    name: http
  type: ClusterIP
```


### –í–∞—Ä–∏–∞–Ω—Ç –ë: Ollama (–ø—Ä–æ—â–µ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞)

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ollama-qwen-coder
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: ollama
        image: ollama/ollama:latest
        ports:
        - containerPort: 11434
        volumeMounts:
        - name: ollama-data
          mountPath: /root/.ollama
        command:
          - /bin/sh
          - -c
          - |
            ollama serve &
            sleep 10
            ollama pull qwen3-coder:14b-q4_K_M
            wait
        resources:
          limits:
            nvidia.com/gpu: 1
```


## –®–∞–≥ 2: MCP –°–µ—Ä–≤–µ—Ä –¥–ª—è Code Review

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**

```
mcp-qwen-code-review/
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts          # MCP server
‚îÇ   ‚îú‚îÄ‚îÄ qwen-cli.ts       # Qwen Code CLI wrapper
‚îÇ   ‚îú‚îÄ‚îÄ gitlab-api.ts     # GitLab integration
‚îÇ   ‚îî‚îÄ‚îÄ review-engine.ts  # Review logic
‚îî‚îÄ‚îÄ k8s/
    ‚îî‚îÄ‚îÄ deployment.yaml
```

**package.json:**

```json
{
  "name": "mcp-qwen-code-review",
  "version": "1.0.0",
  "type": "module",
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.0",
    "@qwen-code/qwen-code": "^1.0.0",
    "simple-git": "^3.25.0",
    "axios": "^1.7.0",
    "diff-parser": "^2.0.0"
  },
  "scripts": {
    "start": "node --loader ts-node/esm src/index.ts"
  }
}
```

**src/index.ts (MCP Server):**

```typescript
#!/usr/bin/env node
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import {
  CallToolRequestSchema,
  ListToolsRequestSchema,
} from "@modelcontextprotocol/sdk/types.js";
import { QwenCodeReviewer } from "./review-engine.js";
import { GitLabAPI } from "./gitlab-api.js";

const server = new Server(
  {
    name: "qwen-code-review-server",
    version: "1.0.0",
  },
  {
    capabilities: {
      tools: {},
    },
  }
);

const reviewer = new QwenCodeReviewer({
  modelEndpoint: process.env.QWEN_API_URL || "http://qwen-coder-api:8000/v1",
  modelName: "Qwen/Qwen3-Coder-14B-Instruct-GPTQ-Int4",
});

const gitlabApi = new GitLabAPI({
  baseUrl: process.env.GITLAB_URL || "https://gitlab.com",
  token: process.env.GITLAB_TOKEN!,
});

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
server.setRequestHandler(ListToolsRequestSchema, async () => ({
  tools: [
    {
      name: "review_merge_request",
      description: "–ü–æ–ª–Ω—ã–π code review Merge Request: –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫, best practices, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏",
      inputSchema: {
        type: "object",
        properties: {
          project_id: {
            type: "string",
            description: "GitLab Project ID",
          },
          merge_request_iid: {
            type: "number",
            description: "MR IID",
          },
          add_comments: {
            type: "boolean",
            description: "–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ GitLab MR",
            default: true,
          },
        },
        required: ["project_id", "merge_request_iid"],
      },
    },
    {
      name: "analyze_code_quality",
      description: "–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞: –æ—à–∏–±–∫–∏, code smells, –Ω–∞—Ä—É—à–µ–Ω–∏—è best practices",
      inputSchema: {
        type: "object",
        properties: {
          code: { type: "string" },
          language: { type: "string" },
          context: { type: "string", description: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç" },
        },
        required: ["code", "language"],
      },
    },
    {
      name: "suggest_refactoring",
      description: "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏",
      inputSchema: {
        type: "object",
        properties: {
          code: { type: "string" },
          language: { type: "string" },
          focus: {
            type: "string",
            enum: ["performance", "readability", "maintainability", "all"],
          },
        },
        required: ["code", "language"],
      },
    },
  ],
}));

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∑–æ–≤–æ–≤
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name, arguments: args } = request.params;

  try {
    switch (name) {
      case "review_merge_request": {
        const { project_id, merge_request_iid, add_comments = true } = args as any;

        // –ü–æ–ª—É—á–∞–µ–º diff –∏–∑ GitLab
        const mrDiff = await gitlabApi.getMRDiff(project_id, merge_request_iid);
        const mrDetails = await gitlabApi.getMRDetails(project_id, merge_request_iid);

        // –í—ã–ø–æ–ª–Ω—è–µ–º review —á–µ—Ä–µ–∑ Qwen Code
        const reviewResult = await reviewer.reviewMR({
          diff: mrDiff,
          title: mrDetails.title,
          description: mrDetails.description,
          sourceBranch: mrDetails.source_branch,
          targetBranch: mrDetails.target_branch,
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ GitLab
        if (add_comments) {
          for (const comment of reviewResult.comments) {
            await gitlabApi.addMRComment(
              project_id,
              merge_request_iid,
              comment.file_path,
              comment.line,
              comment.text
            );
          }

          // –û–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å summary
          await gitlabApi.addMRNote(project_id, merge_request_iid, 
            reviewResult.summary
          );
        }

        return {
          content: [
            {
              type: "text",
              text: JSON.stringify(reviewResult, null, 2),
            },
          ],
        };
      }

      case "analyze_code_quality": {
        const { code, language, context } = args as any;
        const analysis = await reviewer.analyzeQuality(code, language, context);

        return {
          content: [
            {
              type: "text",
              text: JSON.stringify(analysis, null, 2),
            },
          ],
        };
      }

      case "suggest_refactoring": {
        const { code, language, focus } = args as any;
        const suggestions = await reviewer.suggestRefactoring(code, language, focus);

        return {
          content: [
            {
              type: "text",
              text: JSON.stringify(suggestions, null, 2),
            },
          ],
        };
      }

      default:
        throw new Error(`Unknown tool: ${name}`);
    }
  } catch (error) {
    return {
      content: [
        {
          type: "text",
          text: `Error: ${error.message}`,
        },
      ],
      isError: true,
    };
  }
});

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
async function main() {
  const transport = new StdioServerTransport();
  await server.connect(transport);
  console.error("MCP Qwen Code Review Server running on stdio");
}

main().catch(console.error);
```

**src/review-engine.ts (Review Logic):**

```typescript
import { spawn } from "child_process";
import { promisify } from "util";
import { exec as execCb } from "child_process";
import fs from "fs/promises";
import path from "path";

const exec = promisify(execCb);

interface ReviewOptions {
  diff: string;
  title: string;
  description: string;
  sourceBranch: string;
  targetBranch: string;
}

interface ReviewResult {
  summary: string;
  issues: Issue[];
  refactorings: Refactoring[];
  comments: Comment[];
}

interface Issue {
  severity: "error" | "warning" | "info";
  file: string;
  line: number;
  message: string;
  suggestion?: string;
}

interface Refactoring {
  file: string;
  type: string;
  description: string;
  impact: "high" | "medium" | "low";
  code_before: string;
  code_after: string;
}

interface Comment {
  file_path: string;
  line: number;
  text: string;
}

export class QwenCodeReviewer {
  private modelEndpoint: string;
  private modelName: string;

  constructor(config: { modelEndpoint: string; modelName: string }) {
    this.modelEndpoint = config.modelEndpoint;
    this.modelName = config.modelName;
  }

  async reviewMR(options: ReviewOptions): Promise<ReviewResult> {
    const tempDir = await fs.mkdtemp("/tmp/qwen-review-");
    
    try {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º diff –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
      const diffPath = path.join(tempDir, "changes.diff");
      await fs.writeFile(diffPath, options.diff);

      // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è review
      const reviewPrompt = this.buildReviewPrompt(options);
      const promptPath = path.join(tempDir, "prompt.txt");
      await fs.writeFile(promptPath, reviewPrompt);

      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Qwen Code CLI –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏
      const env = {
        ...process.env,
        OPENAI_API_KEY: "dummy-key", // vLLM –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –∫–ª—é—á–∞
        OPENAI_BASE_URL: this.modelEndpoint,
        OPENAI_MODEL: this.modelName,
      };

      // –ó–∞–ø—É—Å–∫–∞–µ–º Qwen Code CLI
      const { stdout, stderr } = await exec(
        `qwen code-review --diff "${diffPath}" --prompt "${promptPath}" --format json`,
        { env, cwd: tempDir }
      );

      // –ü–∞—Ä—Å–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      const rawResult = JSON.parse(stdout);

      // –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      return this.structureResults(rawResult, options.diff);
    } finally {
      // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
      await fs.rm(tempDir, { recursive: true, force: true });
    }
  }

  async analyzeQuality(
    code: string,
    language: string,
    context?: string
  ): Promise<any> {
    const prompt = `
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π ${language} –∫–æ–¥ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
1. –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
2. –ù–∞—Ä—É—à–µ–Ω–∏–π best practices
3. Code smells
4. –ü—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
5. –ü—Ä–æ–±–ª–µ–º —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é

${context ? `–ö–æ–Ω—Ç–µ–∫—Å—Ç: ${context}` : ""}

–ö–æ–¥:
\`\`\`${language}
${code}
\`\`\`

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:
{
  "issues": [
    {
      "severity": "error|warning|info",
      "line": number,
      "category": "string",
      "message": "string",
      "suggestion": "string"
    }
  ],
  "score": number (0-100),
  "summary": "string"
}
`;

    return await this.queryModel(prompt);
  }

  async suggestRefactoring(
    code: string,
    language: string,
    focus: string
  ): Promise<any> {
    const prompt = `
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π ${language} –∫–æ–¥ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.
–§–æ–∫—É—Å –Ω–∞: ${focus}

–ö–æ–¥:
\`\`\`${language}
${code}
\`\`\`

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:
- –£–ª—É—á—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –°–£–©–ï–°–¢–í–ï–ù–ù–´–ú–ò (–Ω–µ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ)
- –§–æ–∫—É—Å –Ω–∞ ${focus === "performance" ? "–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏" : ""}
${focus === "readability" ? "—É–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏" : ""}
${focus === "maintainability" ? "—É–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏" : ""}
${focus === "all" ? "–≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞" : ""}

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ JSON:
{
  "suggestions": [
    {
      "type": "string",
      "impact": "high|medium|low",
      "description": "string",
      "code_before": "string",
      "code_after": "string",
      "benefits": ["string"],
      "effort": "low|medium|high"
    }
  ],
  "priority_order": [number]
}
`;

    return await this.queryModel(prompt);
  }

  private buildReviewPrompt(options: ReviewOptions): string {
    return `
# Code Review Task for Merge Request

## MR Information
- **Title**: ${options.title}
- **Description**: ${options.description}
- **Source Branch**: ${options.sourceBranch}
- **Target Branch**: ${options.targetBranch}

## Review Objectives

### 1. Error Detection & Best Practices
–ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –Ω–∞:
- –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- –ù–∞—Ä—É—à–µ–Ω–∏—è best practices –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –±–∞–≥–∏ –∏ edge cases
- –ü—Ä–æ–±–ª–µ–º—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é
- Memory leaks –∏ resource management

### 2. Architecture & Refactoring Analysis
–î–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π:
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
- –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –µ—Å–ª–∏ –æ–Ω –°–£–©–ï–°–¢–í–ï–ù–ù–û —É–ª—É—á—à–∏—Ç –∫–æ–¥
- –û—Ü–µ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SOLID, DRY, KISS –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
- –ü—Ä–æ–≤–µ—Ä—å dependency management

**–í–∞–∂–Ω–æ**: –ü—Ä–µ–¥–ª–∞–≥–∞–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç—Å—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å (>30%)
- –ü–æ–≤—ã—à–∞–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–∏–∑–º–µ—Ä–∏–º–æ)
- –£–ø—Ä–æ—â–∞–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (—Å–Ω–∏–∂–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)
- –£—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è —Å–µ—Ä—å–µ–∑–Ω—ã–µ code smells

### 3. Code Documentation
–î–æ–±–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫:
- –ü—É–±–ª–∏—á–Ω—ã–º –º–µ—Ç–æ–¥–∞–º –∏ –∫–ª–∞—Å—Å–∞–º (JavaDoc/JSDoc —Å—Ç–∏–ª—å)
- –°–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
- –ù–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º
- –í–∞–∂–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º –∏ trade-offs

**–°—Ç–∏–ª—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**:
- –ö—Ä–∞—Ç–∫–∏–µ, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ
- –û–±—ä—è—Å–Ω—è—é—Ç "–ø–æ—á–µ–º—É", –∞ –Ω–µ "—á—Ç–æ"
- –ù–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –°–ª–µ–¥—É—é—Ç –∫–æ–Ω–≤–µ–Ω—Ü–∏—è–º —è–∑—ã–∫–∞

## Output Format

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ JSON:
\`\`\`json
{
  "summary": {
    "total_files": number,
    "total_issues": number,
    "critical_issues": number,
    "refactoring_suggestions": number,
    "overall_quality_score": number
  },
  "issues": [
    {
      "file": "string",
      "line": number,
      "severity": "critical|high|medium|low",
      "category": "bug|security|performance|style|best-practice",
      "message": "string",
      "suggestion": "string",
      "code_snippet": "string"
    }
  ],
  "refactorings": [
    {
      "file": "string",
      "type": "extract-method|simplify|optimize|restructure",
      "impact": "high|medium|low",
      "description": "string",
      "code_before": "string",
      "code_after": "string",
      "benefits": ["string"],
      "estimated_effort": "low|medium|high"
    }
  ],
  "comments": [
    {
      "file": "string",
      "line": number,
      "type": "javadoc|jsdoc|inline|explanation",
      "text": "string"
    }
  ],
  "recommendations": [
    "string"
  ]
}
\`\`\`

Analyze the diff and provide comprehensive review.
`;
  }

  private async queryModel(prompt: string): Promise<any> {
    const response = await fetch(`${this.modelEndpoint}/chat/completions`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer dummy-key",
      },
      body: JSON.stringify({
        model: this.modelName,
        messages: [
          {
            role: "system",
            content: "You are an expert code reviewer with deep knowledge of software engineering best practices.",
          },
          {
            role: "user",
            content: prompt,
          },
        ],
        temperature: 0.3,
        max_tokens: 8192,
        response_format: { type: "json_object" },
      }),
    });

    const data = await response.json();
    return JSON.parse(data.choices[^2_0].message.content);
  }

  private structureResults(rawResult: any, diff: string): ReviewResult {
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã Qwen –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    return {
      summary: this.generateSummary(rawResult),
      issues: rawResult.issues || [],
      refactorings: rawResult.refactorings || [],
      comments: rawResult.comments || [],
    };
  }

  private generateSummary(result: any): string {
    const { summary } = result;
    return `
## Code Review Summary

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: ${summary.overall_quality_score}/100

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –§–∞–π–ª–æ–≤ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${summary.total_files}
- –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º: ${summary.total_issues}
  - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö: ${summary.critical_issues}
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É: ${summary.refactoring_suggestions}

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
${result.recommendations?.map((r: string) => `- ${r}`).join("\n") || "–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π"}
`;
  }
}
```

**src/gitlab-api.ts:**

```typescript
import axios, { AxiosInstance } from "axios";

export class GitLabAPI {
  private client: AxiosInstance;

  constructor(config: { baseUrl: string; token: string }) {
    this.client = axios.create({
      baseURL: config.baseUrl,
      headers: {
        "PRIVATE-TOKEN": config.token,
      },
    });
  }

  async getMRDiff(projectId: string, mrIid: number): Promise<string> {
    const response = await this.client.get(
      `/api/v4/projects/${projectId}/merge_requests/${mrIid}/changes`
    );
    
    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –µ–¥–∏–Ω—ã–π diff
    return response.data.changes
      .map((change: any) => change.diff)
      .join("\n\n");
  }

  async getMRDetails(projectId: string, mrIid: number): Promise<any> {
    const response = await this.client.get(
      `/api/v4/projects/${projectId}/merge_requests/${mrIid}`
    );
    return response.data;
  }

  async addMRComment(
    projectId: string,
    mrIid: number,
    filePath: string,
    line: number,
    text: string
  ): Promise<void> {
    await this.client.post(
      `/api/v4/projects/${projectId}/merge_requests/${mrIid}/discussions`,
      {
        body: text,
        position: {
          base_sha: await this.getBaseSha(projectId, mrIid),
          start_sha: await this.getStartSha(projectId, mrIid),
          head_sha: await this.getHeadSha(projectId, mrIid),
          position_type: "text",
          new_path: filePath,
          new_line: line,
        },
      }
    );
  }

  async addMRNote(
    projectId: string,
    mrIid: number,
    text: string
  ): Promise<void> {
    await this.client.post(
      `/api/v4/projects/${projectId}/merge_requests/${mrIid}/notes`,
      { body: text }
    );
  }

  private async getBaseSha(projectId: string, mrIid: number): Promise<string> {
    const mr = await this.getMRDetails(projectId, mrIid);
    return mr.diff_refs.base_sha;
  }

  private async getStartSha(projectId: string, mrIid: number): Promise<string> {
    const mr = await this.getMRDetails(projectId, mrIid);
    return mr.diff_refs.start_sha;
  }

  private async getHeadSha(projectId: string, mrIid: number): Promise<string> {
    const mr = await this.getMRDetails(projectId, mrIid);
    return mr.diff_refs.head_sha;
  }
}
```

**Dockerfile:**

```dockerfile
FROM node:20-alpine

WORKDIR /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Qwen Code CLI
RUN npm install -g @qwen-code/qwen-code

# –ö–æ–ø–∏—Ä—É–µ–º package.json
COPY package*.json ./
RUN npm install

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏
COPY src/ ./src/
COPY tsconfig.json ./

# –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º TypeScript
RUN npm run build

EXPOSE 3000

CMD ["node", "dist/index.js"]
```

**k8s/deployment.yaml:**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mcp-qwen-review
  namespace: ai-services
spec:
  replicas: 2
  selector:
    matchLabels:
      app: mcp-qwen-review
  template:
    metadata:
      labels:
        app: mcp-qwen-review
    spec:
      containers:
      - name: mcp-server
        image: your-registry/mcp-qwen-review:latest
        env:
        - name: QWEN_API_URL
          value: "http://qwen-coder-api:8000/v1"
        - name: GITLAB_URL
          valueFrom:
            secretKeyRef:
              name: gitlab-credentials
              key: url
        - name: GITLAB_TOKEN
          valueFrom:
            secretKeyRef:
              name: gitlab-credentials
              key: token
        ports:
        - containerPort: 3000
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
---
apiVersion: v1
kind: Service
metadata:
  name: mcp-qwen-review
  namespace: ai-services
spec:
  selector:
    app: mcp-qwen-review
  ports:
  - port: 3000
    targetPort: 3000
  type: ClusterIP
```


## –®–∞–≥ 3: n8n Workflow –¥–ª—è Code Review

**Workflow nodes:**

```json
{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "review-mr",
        "responseMode": "responseNode",
        "options": {}
      },
      "name": "Webhook - MR Created",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "http://mcp-qwen-review.ai-services:3000/tools/call",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "tool",
              "value": "review_merge_request"
            },
            {
              "name": "arguments",
              "value": "={{ JSON.stringify({\n  project_id: $json.body.project.id,\n  merge_request_iid: $json.body.object_attributes.iid,\n  add_comments: true\n}) }}"
            }
          ]
        },
        "options": {
          "timeout": 300000
        }
      },
      "name": "HTTP Request - MCP Review",
      "type": "n8n-nodes-base.httpRequest",
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.summary.critical_issues }}",
              "operation": "largerEqual",
              "value2": "1"
            }
          ]
        }
      },
      "name": "IF - Critical Issues",
      "type": "n8n-nodes-base.if",
      "position": [650, 300]
    },
    {
      "parameters": {
        "channel": "#code-reviews",
        "text": "üö® Critical issues found in MR !{{ $json.body.object_attributes.iid }}\n\n{{ $json.review.summary }}\n\nLink: {{ $json.body.object_attributes.url }}"
      },
      "name": "Slack - Notify Critical",
      "type": "n8n-nodes-base.slack",
      "position": [850, 200]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({\n  status: 'success',\n  review_completed: true,\n  issues_found: $json.summary.total_issues\n}) }}"
      },
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1050, 300]
    }
  ],
  "connections": {
    "Webhook - MR Created": {
      "main": [[{"node": "HTTP Request - MCP Review", "type": "main", "index": 0}]]
    },
    "HTTP Request - MCP Review": {
      "main": [[{"node": "IF - Critical Issues", "type": "main", "index": 0}]]
    },
    "IF - Critical Issues": {
      "main": [
        [{"node": "Slack - Notify Critical", "type": "main", "index": 0}],
        [{"node": "Respond to Webhook", "type": "main", "index": 0}]
      ]
    },
    "Slack - Notify Critical": {
      "main": [[{"node": "Respond to Webhook", "type": "main", "index": 0}]]
    }
  }
}
```


## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitLab Webhook

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö GitLab –ø—Ä–æ–µ–∫—Ç–∞:

```
URL: https://your-n8n.domain/webhook/review-mr
Secret Token: <your-secret>
Trigger: Merge request events
```


## –†–µ–∑—é–º–µ

**–î–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏ –≤–∞–º –Ω—É–∂–Ω–æ:**

1. **–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å Qwen3-Coder** –≤ K8s —á–µ—Ä–µ–∑ vLLM (GPTQ-Int4 –º–æ–¥–µ–ª—å ~14B –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤)
2. **–°–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä** –∫–æ—Ç–æ—Ä—ã–π:
    - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç n8n
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Qwen Code CLI —Å –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é
    - –í—ã–ø–æ–ª–Ω—è–µ—Ç 3 –∑–∞–¥–∞—á–∏ review
    - –ü—É–±–ª–∏–∫—É–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ GitLab
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å n8n workflow** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ MR

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —ç—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**

- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é on-premises
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–∞—à–∏ –º–æ–¥–µ–ª–∏
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≤ K8s
- ‚úÖ MCP –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ n8n —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–µ–π

–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —á–∞—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏?
<span style="display:none">[^2_1][^2_10][^2_2][^2_3][^2_4][^2_5][^2_6][^2_7][^2_8][^2_9]</span>

<div align="center">‚ÅÇ</div>

[^2_1]: https://github.com/QwenLM/qwen-code

[^2_2]: https://www.datacamp.com/tutorial/qwen-code

[^2_3]: https://www.reddit.com/r/LocalLLaMA/comments/1men28l/guide_the_simple_selfhosted_ai_coding_that_just/

[^2_4]: https://blog.logrocket.com/qwen-3-coder-agentic-cli/

[^2_5]: https://docs.cloudbase.net/en/cli-v1/ai/qwen

[^2_6]: https://northflank.com/blog/self-host-qwen3-coder-with-vllm

[^2_7]: https://github.com/Orcus2021/code-review-mcp-server

[^2_8]: https://qwen.ai/blog?id=d927d7d2e59d059045ce758ded34f98c0186d2d7\&from=research.research-list

[^2_9]: https://www.datacamp.com/tutorial/run-qwen3-coder-locally

[^2_10]: https://mcp.so/server/mcp-server-code-review/arahisman


---

# –ù–∞ –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ - –¥–æ–ª–∂–µ–Ω —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ú–† –≤ –∏—Å—Ö–æ–¥–Ω—É—é —Ñ–∏—á–∞–≤–µ—Ç–∫—É, –∫–æ—Ç–æ—Ä–∞—è –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å.

–ø–µ—Ä–µ–≤–µ–¥–∏ –∫–æ–¥ MCP  –Ω–∞ docker-ready python –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –¥–æ–±–∞–≤—å rest  api –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ n8n workflow. –°—Ü–µ–Ω–∞—Ä–∏–π - n8n –ø–æ–ª—É—á–∞–µ—Ç webhook –æ—Ç –≥–∏—Ç–ª–∞–±  –ú–†; –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è http request(–ª–∏–±–æ –∞–≥–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç mcp-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç) –Ω–∞  review/mcp —Å–µ—Ä–≤–µ—Ä.  –û–ø–∏—à–∏  workflow, –≤—Ö/–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∞–ø–∏.  –ü—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é langchain –Ω–æ–¥—ã, –≤ –∫–æ—Ç–æ—Ä–æ–π –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ä–µ–∫–≤–µ—Å—Ç –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±–∞–∑–æ–≤—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º ( –Ω–æ–º–µ—Ä –∂–∏—Ä–∞ —Ç–∏–∫–µ—Ç–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏, —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π message),  –µ—Å–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç (–∏–Ω–∞—á–µ - –≤ –¥—Ä–∞—Ñ—Ç) , —Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–≤—å—é.

–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º MR –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π! –ü–µ—Ä–µ–≤–µ–¥—É —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ Python + REST API + LangChain –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   GitLab     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   n8n Workflow  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  LangChain Node  ‚îÇ
‚îÇ   Webhook    ‚îÇ     ‚îÇ                 ‚îÇ     ‚îÇ   Validation     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ                         ‚îÇ
                            ‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ                    ‚îÇ          ‚îÇ
                            ‚ñº                    ‚ñº          ‚ñº
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      Valid?      Invalid?
                     ‚îÇ  Review API  ‚îÇ       ‚îÇ              ‚îÇ
                     ‚îÇ  (Python)    ‚îÇ       ‚îÇ              ‚ñº
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ      Set MR to Draft
                            ‚îÇ               ‚îÇ
                            ‚ñº               ‚îÇ
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
                     ‚îÇ  Qwen Code   ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ  Analysis    ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ  GitLab API  ‚îÇ
                     ‚îÇ  Create MR   ‚îÇ
                     ‚îÇ  Add Comments‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```


## Python Review Service

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
qwen-code-review-service/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI app
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ models.py            # Pydantic models
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ qwen_reviewer.py # Core review logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gitlab_service.py# GitLab integration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mr_creator.py    # Auto MR creation
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.py        # API endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schemas.py       # API schemas
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ diff_parser.py   # Diff parsing
‚îî‚îÄ‚îÄ k8s/
    ‚îî‚îÄ‚îÄ deployment.yaml
```


### requirements.txt

```txt
fastapi==0.109.0
uvicorn[standard]==0.27.0
pydantic==2.5.0
pydantic-settings==2.1.0
python-gitlab==4.4.0
openai==1.12.0
langchain==0.1.6
langchain-openai==0.0.5
httpx==0.26.0
python-multipart==0.0.9
unidiff==0.7.5
tenacity==8.2.3
redis==5.0.1
celery==5.3.6
```


### app/config.py

```python
from pydantic_settings import BaseSettings
from functools import lru_cache


class Settings(BaseSettings):
    # App settings
    APP_NAME: str = "Qwen Code Review Service"
    APP_VERSION: str = "1.0.0"
    DEBUG: bool = False
    HOST: str = "0.0.0.0"
    PORT: int = 8000
    
    # Qwen Model settings
    QWEN_API_URL: str = "http://qwen-coder-api:8000/v1"
    QWEN_MODEL_NAME: str = "Qwen/Qwen3-Coder-14B-Instruct-GPTQ-Int4"
    QWEN_API_KEY: str = "dummy-key"
    QWEN_MAX_TOKENS: int = 8192
    QWEN_TEMPERATURE: float = 0.3
    
    # GitLab settings
    GITLAB_URL: str = "https://gitlab.com"
    GITLAB_TOKEN: str
    GITLAB_AUTO_CREATE_MR: bool = True
    GITLAB_MR_LABELS: list[str] = ["code-review", "auto-generated"]
    
    # Review settings
    REVIEW_MIN_QUALITY_SCORE: int = 70
    REVIEW_CREATE_MR_FOR_REFACTORING: bool = True
    REVIEW_AUTO_APPROVE_MINOR_FIXES: bool = False
    
    # MCP Server settings (optional)
    MCP_ENABLED: bool = False
    MCP_PORT: int = 3000
    
    # Redis (for async tasks)
    REDIS_URL: str = "redis://localhost:6379/0"
    
    class Config:
        env_file = ".env"
        case_sensitive = True


@lru_cache()
def get_settings() -> Settings:
    return Settings()
```


### app/models.py

```python
from pydantic import BaseModel, Field
from typing import List, Optional, Literal
from datetime import datetime


class ReviewRequest(BaseModel):
    """–í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å –Ω–∞ review"""
    project_id: str = Field(..., description="GitLab Project ID")
    merge_request_iid: int = Field(..., description="MR IID")
    create_fix_mr: bool = Field(True, description="–°–æ–∑–¥–∞—Ç—å MR —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏")
    add_comments: bool = Field(True, description="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ MR")
    webhook_data: Optional[dict] = Field(None, description="Raw GitLab webhook data")


class Issue(BaseModel):
    file: str
    line: int
    severity: Literal["critical", "high", "medium", "low"]
    category: Literal["bug", "security", "performance", "style", "best-practice"]
    message: str
    suggestion: Optional[str] = None
    code_snippet: Optional[str] = None


class Refactoring(BaseModel):
    file: str
    type: Literal["extract-method", "simplify", "optimize", "restructure"]
    impact: Literal["high", "medium", "low"]
    description: str
    code_before: str
    code_after: str
    benefits: List[str]
    estimated_effort: Literal["low", "medium", "high"]


class CodeComment(BaseModel):
    file: str
    line: int
    type: Literal["javadoc", "jsdoc", "inline", "explanation"]
    text: str


class ReviewSummary(BaseModel):
    total_files: int
    total_issues: int
    critical_issues: int
    refactoring_suggestions: int
    overall_quality_score: int


class ReviewResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç review"""
    summary: ReviewSummary
    issues: List[Issue]
    refactorings: List[Refactoring]
    comments: List[CodeComment]
    recommendations: List[str]
    fix_mr_url: Optional[str] = None
    fix_mr_iid: Optional[int] = None


class ReviewResponse(BaseModel):
    """–û—Ç–≤–µ—Ç API"""
    status: Literal["success", "error", "validation_failed"]
    message: str
    review: Optional[ReviewResult] = None
    validation_errors: Optional[List[str]] = None
    processing_time: float
    timestamp: datetime = Field(default_factory=datetime.utcnow)


class MRValidationRequest(BaseModel):
    """–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é MR —á–µ—Ä–µ–∑ LangChain"""
    title: str
    description: str
    source_branch: str
    target_branch: str
    author: str


class MRValidationResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ MR"""
    is_valid: bool
    validation_errors: List[str] = Field(default_factory=list)
    jira_ticket: Optional[str] = None
    has_meaningful_description: bool
    should_draft: bool
    score: int = Field(ge=0, le=100)
```


### app/services/qwen_reviewer.py

```python
import json
import re
from typing import Dict, List, Optional
from openai import OpenAI
from tenacity import retry, stop_after_attempt, wait_exponential
import logging

from app.config import get_settings
from app.models import (
    ReviewResult, ReviewSummary, Issue, Refactoring, CodeComment
)

logger = logging.getLogger(__name__)
settings = get_settings()


class QwenCodeReviewer:
    def __init__(self):
        self.client = OpenAI(
            api_key=settings.QWEN_API_KEY,
            base_url=settings.QWEN_API_URL
        )
        self.model = settings.QWEN_MODEL_NAME
    
    @retry(
        stop=stop_after_attempt(3),
        wait=wait_exponential(multiplier=1, min=4, max=10)
    )
    async def review_merge_request(
        self,
        diff: str,
        title: str,
        description: str,
        source_branch: str,
        target_branch: str,
        files_changed: List[str]
    ) -> ReviewResult:
        """–ü–æ–ª–Ω—ã–π review MR"""
        
        logger.info(f"Starting review for MR: {title}")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
        prompt = self._build_review_prompt(
            diff, title, description, source_branch, target_branch, files_changed
        )
        
        # –í—ã–∑—ã–≤–∞–µ–º –º–æ–¥–µ–ª—å
        response = await self._query_model(prompt)
        
        # –ü–∞—Ä—Å–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        result_data = self._parse_response(response)
        
        # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        return self._structure_results(result_data)
    
    async def _query_model(self, prompt: str) -> str:
        """–ó–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ Qwen"""
        try:
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {
                        "role": "system",
                        "content": (
                            "You are an expert code reviewer with deep knowledge of "
                            "software engineering best practices, SOLID principles, "
                            "design patterns, and security. You provide detailed, "
                            "actionable feedback in JSON format."
                        )
                    },
                    {
                        "role": "user",
                        "content": prompt
                    }
                ],
                temperature=settings.QWEN_TEMPERATURE,
                max_tokens=settings.QWEN_MAX_TOKENS,
                response_format={"type": "json_object"}
            )
            
            return response.choices[0].message.content
            
        except Exception as e:
            logger.error(f"Error querying Qwen model: {e}")
            raise
    
    def _build_review_prompt(
        self,
        diff: str,
        title: str,
        description: str,
        source_branch: str,
        target_branch: str,
        files_changed: List[str]
    ) -> str:
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è review"""
        
        return f"""
# Code Review Task for Merge Request

## MR Information
- **Title**: {title}
- **Description**: {description}
- **Source Branch**: {source_branch}
- **Target Branch**: {target_branch}
- **Files Changed**: {len(files_changed)}

## Files Modified
{chr(10).join(f"- {f}" for f in files_changed[:20])}
{f"... and {len(files_changed) - 20} more files" if len(files_changed) > 20 else ""}

## Review Objectives

### 1. Error Detection & Best Practices
–ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –Ω–∞:
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- ‚úÖ –ù–∞—Ä—É—à–µ–Ω–∏—è best practices (SOLID, DRY, KISS)
- ‚úÖ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –±–∞–≥–∏ –∏ edge cases
- ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é (SQL injection, XSS, CSRF)
- ‚úÖ Memory leaks –∏ resource management
- ‚úÖ Thread safety –∏ concurrency issues
- ‚úÖ Error handling –∏ exception management

**Severity levels**:
- `critical`: –ë–∞–≥–∏, security issues, data loss risks
- `high`: Performance problems, design flaws
- `medium`: Code smells, maintainability issues
- `low`: Style violations, minor improvements

### 2. Architecture & Refactoring Analysis
–î–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π:
- üèóÔ∏è –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
- üîß –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –æ–Ω –°–£–©–ï–°–¢–í–ï–ù–ù–û —É–ª—É—á—à–∏—Ç –∫–æ–¥
- üìä –û—Ü–µ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SOLID, DRY, KISS –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
- üîó –ü—Ä–æ–≤–µ—Ä—å dependency management –∏ coupling

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞**:
- ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç—Å—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å (>30% —Å–Ω–∏–∂–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)
- ‚úÖ –ü–æ–≤—ã—à–∞–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–∏–∑–º–µ—Ä–∏–º–æ, >20%)
- ‚úÖ –£–ø—Ä–æ—â–∞–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (—Å–Ω–∏–∂–µ–Ω–∏–µ cyclomatic complexity)
- ‚úÖ –£—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è —Å–µ—Ä—å–µ–∑–Ω—ã–µ code smells (God Class, Long Method, etc.)
- ‚ùå –ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚ùå –ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–¥–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### 3. Code Documentation
–î–æ–±–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫:
- üìù –ü—É–±–ª–∏—á–Ω—ã–º –º–µ—Ç–æ–¥–∞–º –∏ –∫–ª–∞—Å—Å–∞–º (JavaDoc/JSDoc/PyDoc —Å—Ç–∏–ª—å)
- üß† –°–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
- üî¢ –ù–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º
- ‚öñÔ∏è –í–∞–∂–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º –∏ trade-offs

**–°—Ç–∏–ª—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**:
- –ö—Ä–∞—Ç–∫–∏–µ, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ (1-3 —Å—Ç—Ä–æ–∫–∏)
- –û–±—ä—è—Å–Ω—è—é—Ç "–ø–æ—á–µ–º—É", –∞ –Ω–µ "—á—Ç–æ"
- –ù–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –°–ª–µ–¥—É—é—Ç –∫–æ–Ω–≤–µ–Ω—Ü–∏—è–º —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è

## Diff Content

```

{diff[:50000]}  \# –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

```

## Output Format

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –°–¢–†–û–ì–û –≤ —Å–ª–µ–¥—É—é—â–µ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ:

```

{{
"summary": {{
"total_files": <number>,
"total_issues": <number>,
"critical_issues": <number>,
"refactoring_suggestions": <number>,
"overall_quality_score": <number 0-100>
}},
"issues": [
{{
"file": "path/to/file.py",
"line": 42,
"severity": "critical|high|medium|low",
"category": "bug|security|performance|style|best-practice",
"message": "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã",
"suggestion": "–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é",
"code_snippet": "–§—Ä–∞–≥–º–µ–Ω—Ç –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∫–æ–¥–∞"
}}
],
"refactorings": [
{{
"file": "path/to/file.py",
"type": "extract-method|simplify|optimize|restructure",
"impact": "high|medium|low",
"description": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞",
"code_before": "–¢–µ–∫—É—â–∏–π –∫–æ–¥",
"code_after": "–£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–æ–¥",
"benefits": ["–ü–æ–ª—å–∑–∞ 1", "–ü–æ–ª—å–∑–∞ 2"],
"estimated_effort": "low|medium|high"
}}
],
"comments": [
{{
"file": "path/to/file.py",
"line": 10,
"type": "javadoc|jsdoc|inline|explanation",
"text": "/**\\n * –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞\\n * @param x –ø–∞—Ä–∞–º–µ—Ç—Ä\\n * @return —Ä–µ–∑—É–ª—å—Ç–∞—Ç\\n */"
}}
],
"recommendations": [
"–û–±—â–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1",
"–û–±—â–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2"
]
}}

```

**–í–ê–ñ–ù–û**:
- –í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON
- –í—Å–µ —Å—Ç—Ä–æ–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏–π
- –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ actionable
"""
    
    def _parse_response(self, response: str) -> dict:
        """–ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏"""
        try:
            # –£–±–∏—Ä–∞–µ–º markdown –µ—Å–ª–∏ –µ—Å—Ç—å
            response = response.strip()
            if response.startswith("```
                response = response[7:]
            if response.endswith("```"):
                response = response[:-3]
            
            return json.loads(response.strip())
        except json.JSONDecodeError as e:
            logger.error(f"Failed to parse JSON response: {e}")
            logger.debug(f"Response was: {response[:500]}")
            raise
    
    def _structure_results(self, data: dict) -> ReviewResult:
        """–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
        
        return ReviewResult(
            summary=ReviewSummary(**data.get("summary", {})),
            issues=[Issue(**issue) for issue in data.get("issues", [])],
            refactorings=[
                Refactoring(**ref) for ref in data.get("refactorings", [])
            ],
            comments=[
                CodeComment(**comment) for comment in data.get("comments", [])
            ],
            recommendations=data.get("recommendations", [])
        )
```


### app/services/gitlab_service.py

```python
import gitlab
from typing import Dict, List, Optional
import logging

from app.config import get_settings

logger = logging.getLogger(__name__)
settings = get_settings()


class GitLabService:
    def __init__(self):
        self.gl = gitlab.Gitlab(
            settings.GITLAB_URL,
            private_token=settings.GITLAB_TOKEN
        )
        self.gl.auth()
    
    def get_mr_details(self, project_id: str, mr_iid: int) -> Dict:
        """–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ MR"""
        project = self.gl.projects.get(project_id)
        mr = project.mergerequests.get(mr_iid)
        
        return {
            "title": mr.title,
            "description": mr.description or "",
            "source_branch": mr.source_branch,
            "target_branch": mr.target_branch,
            "author": mr.author["username"],
            "state": mr.state,
            "web_url": mr.web_url,
            "diff_refs": mr.diff_refs,
            "sha": mr.sha
        }
    
    def get_mr_changes(self, project_id: str, mr_iid: int) -> tuple[str, List[str]]:
        """–ü–æ–ª—É—á–∏—Ç—å diff –∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤"""
        project = self.gl.projects.get(project_id)
        mr = project.mergerequests.get(mr_iid)
        changes = mr.changes()
        
        # –°–æ–±–∏—Ä–∞–µ–º diff
        diff_text = "\n\n".join(
            change["diff"] for change in changes["changes"]
        )
        
        # –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
        files = [
            change["new_path"] for change in changes["changes"]
        ]
        
        return diff_text, files
    
    def add_mr_comment(
        self,
        project_id: str,
        mr_iid: int,
        file_path: str,
        line: int,
        text: str
    ) -> None:
        """–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Å—Ç—Ä–æ–∫–µ –≤ MR"""
        project = self.gl.projects.get(project_id)
        mr = project.mergerequests.get(mr_iid)
        
        try:
            # –ü–æ–ª—É—á–∞–µ–º diff refs –¥–ª—è position
            diff_refs = mr.diff_refs
            
            # –°–æ–∑–¥–∞–µ–º discussion —Å position
            mr.discussions.create({
                "body": text,
                "position": {
                    "base_sha": diff_refs["base_sha"],
                    "start_sha": diff_refs["start_sha"],
                    "head_sha": diff_refs["head_sha"],
                    "position_type": "text",
                    "new_path": file_path,
                    "new_line": line
                }
            })
            logger.info(f"Added comment to {file_path}:{line}")
        except Exception as e:
            logger.error(f"Failed to add comment: {e}")
            # Fallback: –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –æ–±—ã—á–Ω—É—é note
            mr.notes.create({"body": f"**{file_path}:{line}**\n\n{text}"})
    
    def add_mr_note(self, project_id: str, mr_iid: int, text: str) -> None:
        """–î–æ–±–∞–≤–∏—Ç—å –æ–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ MR"""
        project = self.gl.projects.get(project_id)
        mr = project.mergerequests.get(mr_iid)
        mr.notes.create({"body": text})
        logger.info(f"Added note to MR !{mr_iid}")
    
    def set_mr_draft(self, project_id: str, mr_iid: int) -> None:
        """–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ MR –≤ Draft"""
        project = self.gl.projects.get(project_id)
        mr = project.mergerequests.get(mr_iid)
        
        if not mr.work_in_progress:
            mr.title = f"Draft: {mr.title}"
            mr.save()
            logger.info(f"Set MR !{mr_iid} to Draft")
    
    def create_branch_from_mr(
        self,
        project_id: str,
        source_mr_iid: int,
        new_branch_name: str
    ) -> str:
        """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –∏–∑ source branch MR"""
        project = self.gl.projects.get(project_id)
        mr = project.mergerequests.get(source_mr_iid)
        
        # –°–æ–∑–¥–∞–µ–º –≤–µ—Ç–∫—É –∏–∑ source_branch
        branch = project.branches.create({
            "branch": new_branch_name,
            "ref": mr.source_branch
        })
        
        logger.info(f"Created branch {new_branch_name} from {mr.source_branch}")
        return branch.name
    
    def commit_changes(
        self,
        project_id: str,
        branch: str,
        commit_message: str,
        actions: List[Dict]
    ) -> str:
        """–°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏"""
        project = self.gl.projects.get(project_id)
        
        commit = project.commits.create({
            "branch": branch,
            "commit_message": commit_message,
            "actions": actions
        })
        
        logger.info(f"Created commit {commit.id} in {branch}")
        return commit.id
```


### app/services/mr_creator.py

```python
import re
from typing import List, Dict
import logging

from app.models import ReviewResult, Issue, Refactoring, CodeComment
from app.services.gitlab_service import GitLabService
from app.config import get_settings

logger = logging.getLogger(__name__)
settings = get_settings()


class MRCreator:
    def __init__(self, gitlab_service: GitLabService):
        self.gitlab = gitlab_service
    
    async def create_fix_mr(
        self,
        project_id: str,
        source_mr_iid: int,
        review: ReviewResult
    ) -> tuple[str, int]:
        """
        –°–æ–∑–¥–∞—Ç—å MR —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏/—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
        
        Returns:
            (mr_url, mr_iid)
        """
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ MR
        source_mr = self.gitlab.get_mr_details(project_id, source_mr_iid)
        source_branch = source_mr["source_branch"]
        
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
        fix_branch_name = f"code-review-fixes/{source_branch}"
        self.gitlab.create_branch_from_mr(project_id, source_mr_iid, fix_branch_name)
        
        # –ì–æ—Ç–æ–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
        commit_actions = []
        
        # 1. –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
        if review.refactorings:
            commit_actions.extend(
                self._prepare_refactoring_actions(review.refactorings)
            )
        
        # 2. –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥
        if review.comments:
            commit_actions.extend(
                self._prepare_comment_actions(review.comments)
            )
        
        # 3. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω—ã–µ issues (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ)
        critical_issues = [
            issue for issue in review.issues 
            if issue.severity == "critical" and issue.suggestion
        ]
        if critical_issues:
            commit_actions.extend(
                self._prepare_fix_actions(critical_issues)
            )
        
        if not commit_actions:
            logger.info("No automated fixes to apply")
            return None, None
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç
        commit_message = self._generate_commit_message(review)
        self.gitlab.commit_changes(
            project_id,
            fix_branch_name,
            commit_message,
            commit_actions
        )
        
        # –°–æ–∑–¥–∞–µ–º MR
        mr_title = f"ü§ñ Code Review Fixes: {source_mr['title']}"
        mr_description = self._generate_mr_description(review, source_mr_iid)
        
        from gitlab import Gitlab
        gl = Gitlab(settings.GITLAB_URL, private_token=settings.GITLAB_TOKEN)
        gl.auth()
        project = gl.projects.get(project_id)
        
        new_mr = project.mergerequests.create({
            "source_branch": fix_branch_name,
            "target_branch": source_branch,
            "title": mr_title,
            "description": mr_description,
            "labels": settings.GITLAB_MR_LABELS,
            "remove_source_branch": True
        })
        
        logger.info(f"Created fix MR !{new_mr.iid}: {new_mr.web_url}")
        
        return new_mr.web_url, new_mr.iid
    
    def _prepare_refactoring_actions(
        self,
        refactorings: List[Refactoring]
    ) -> List[Dict]:
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞"""
        actions = []
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ñ–∞–π–ª–∞–º
        by_file = {}
        for ref in refactorings:
            if ref.file not in by_file:
                by_file[ref.file] = []
            by_file[ref.file].append(ref)
        
        for file_path, refs in by_file.items():
            # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª (—á–µ—Ä–µ–∑ GitLab API)
            # –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∏
            # –ó–¥–µ—Å—å —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ —á–∏—Ç–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
            
            for ref in refs:
                actions.append({
                    "action": "update",
                    "file_path": file_path,
                    "content": ref.code_after,
                    "encoding": "text"
                })
        
        return actions
    
    def _prepare_comment_actions(
        self,
        comments: List[CodeComment]
    ) -> List[Dict]:
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –∫–æ–¥"""
        actions = []
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ñ–∞–π–ª–∞–º
        by_file = {}
        for comment in comments:
            if comment.file not in by_file:
                by_file[comment.file] = []
            by_file[comment.file].append(comment)
        
        for file_path, file_comments in by_file.items():
            # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∏ –≤—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            # –ó–¥–µ—Å—å placeholder –ª–æ–≥–∏–∫–∞
            pass
        
        return actions
    
    def _prepare_fix_actions(self, issues: List[Issue]) -> List[Dict]:
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è issues"""
        actions = []
        
        # –¢–æ–ª—å–∫–æ issues —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ suggestions
        for issue in issues:
            if issue.suggestion and issue.code_snippet:
                actions.append({
                    "action": "update",
                    "file_path": issue.file,
                    # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–º–µ–Ω—ã
                    "content": issue.suggestion,
                    "encoding": "text"
                })
        
        return actions
    
    def _generate_commit_message(self, review: ReviewResult) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è commit message"""
        parts = ["ü§ñ Automated code review fixes\n"]
        
        if review.refactorings:
            parts.append(f"- Applied {len(review.refactorings)} refactoring(s)")
        
        if review.comments:
            parts.append(f"- Added {len(review.comments)} code comment(s)")
        
        critical = sum(1 for i in review.issues if i.severity == "critical")
        if critical:
            parts.append(f"- Fixed {critical} critical issue(s)")
        
        parts.append(f"\nQuality score: {review.summary.overall_quality_score}/100")
        
        return "\n".join(parts)
    
    def _generate_mr_description(
        self,
        review: ReviewResult,
        source_mr_iid: int
    ) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è MR"""
        
        desc = f"""
## ü§ñ Automated Code Review Fixes

–≠—Ç–æ—Ç MR —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ code review –∏—Å—Ö–æ–¥–Ω–æ–≥–æ MR !{source_mr_iid}.

### üìä Summary
- **Quality Score**: {review.summary.overall_quality_score}/100
- **Issues Found**: {review.summary.total_issues}
- **Critical Issues**: {review.summary.critical_issues}
- **Refactorings Applied**: {len(review.refactorings)}
- **Comments Added**: {len(review.comments)}

### üîß Changes Applied

"""
        
        if review.refactorings:
            desc += "#### Refactorings\n"
            for ref in review.refactorings[:5]:
                desc += f"- **{ref.file}**: {ref.description} (Impact: {ref.impact})\n"
        
        if review.comments:
            desc += "\n#### Documentation Added\n"
            desc += f"- Added {len(review.comments)} code comments\n"
        
        critical = [i for i in review.issues if i.severity == "critical"]
        if critical:
            desc += "\n#### Critical Fixes\n"
            for issue in critical[:5]:
                desc += f"- **{issue.file}:{issue.line}**: {issue.message}\n"
        
        desc += f"""

### üìù Recommendations
{chr(10).join(f"- {rec}" for rec in review.recommendations[:5])}

---
*Generated by Qwen Code Review Service*
*Merge this MR into source branch `!{source_mr_iid}` to apply fixes*
"""
        
        return desc
```


### app/api/routes.py

```python
from fastapi import APIRouter, HTTPException, BackgroundTasks
from typing import Dict
import time
import logging

from app.models import (
    ReviewRequest, ReviewResponse, MRValidationRequest,
    MRValidationResult
)
from app.services.qwen_reviewer import QwenCodeReviewer
from app.services.gitlab_service import GitLabService
from app.services.mr_creator import MRCreator

logger = logging.getLogger(__name__)
router = APIRouter()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
reviewer = QwenCodeReviewer()
gitlab_service = GitLabService()
mr_creator = MRCreator(gitlab_service)


@router.post("/review", response_model=ReviewResponse)
async def review_merge_request(
    request: ReviewRequest,
    background_tasks: BackgroundTasks
):
    """
    –ì–ª–∞–≤–Ω—ã–π endpoint –¥–ª—è review MR
    
    –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - project_id: GitLab Project ID (str)
    - merge_request_iid: MR IID (int)
    - create_fix_mr: —Å–æ–∑–¥–∞—Ç—å MR —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ (bool, default=True)
    - add_comments: –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã–π MR (bool, default=True)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - ReviewResponse —Å –ø–æ–ª–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ review
    """
    start_time = time.time()
    
    try:
        # 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ MR –∏–∑ GitLab
        logger.info(
            f"Starting review for project {request.project_id}, MR !{request.merge_request_iid}"
        )
        
        mr_details = gitlab_service.get_mr_details(
            request.project_id,
            request.merge_request_iid
        )
        
        diff, files_changed = gitlab_service.get_mr_changes(
            request.project_id,
            request.merge_request_iid
        )
        
        # 2. –í—ã–ø–æ–ª–Ω—è–µ–º review —á–µ—Ä–µ–∑ Qwen
        review_result = await reviewer.review_merge_request(
            diff=diff,
            title=mr_details["title"],
            description=mr_details["description"],
            source_branch=mr_details["source_branch"],
            target_branch=mr_details["target_branch"],
            files_changed=files_changed
        )
        
        # 3. –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ GitLab (–µ—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–æ)
        if request.add_comments:
            background_tasks.add_task(
                _add_review_comments,
                request.project_id,
                request.merge_request_iid,
                review_result
            )
        
        # 4. –°–æ–∑–¥–∞–µ–º MR —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ (–µ—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–æ)
        if request.create_fix_mr and (
            review_result.refactorings or 
            review_result.comments or
            any(i.severity == "critical" for i in review_result.issues)
        ):
            fix_mr_url, fix_mr_iid = await mr_creator.create_fix_mr(
                request.project_id,
                request.merge_request_iid,
                review_result
            )
            review_result.fix_mr_url = fix_mr_url
            review_result.fix_mr_iid = fix_mr_iid
        
        processing_time = time.time() - start_time
        
        return ReviewResponse(
            status="success",
            message=f"Review completed successfully in {processing_time:.2f}s",
            review=review_result,
            processing_time=processing_time
        )
        
    except Exception as e:
        logger.error(f"Review failed: {e}", exc_info=True)
        raise HTTPException(status_code=500, detail=str(e))


@router.post("/validate-mr", response_model=MRValidationResult)
async def validate_mr(request: MRValidationRequest):
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è MR –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±–∞–∑–æ–≤—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è LangChain –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
    - –ù–∞–ª–∏—á–∏–µ JIRA —Ç–∏–∫–µ—Ç–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
    - –°–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å description
    
    –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - title: –∑–∞–≥–æ–ª–æ–≤–æ–∫ MR
    - description: –æ–ø–∏—Å–∞–Ω–∏–µ MR
    - source_branch: –∏—Å—Ö–æ–¥–Ω–∞—è –≤–µ—Ç–∫–∞
    - target_branch: —Ü–µ–ª–µ–≤–∞—è –≤–µ—Ç–∫–∞
    - author: –∞–≤—Ç–æ—Ä MR
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - MRValidationResult —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    """
    from app.utils.validators import MRValidator
    
    validator = MRValidator()
    result = await validator.validate(
        title=request.title,
        description=request.description,
        source_branch=request.source_branch,
        target_branch=request.target_branch,
        author=request.author
    )
    
    return result


async def _add_review_comments(
    project_id: str,
    mr_iid: int,
    review: "ReviewResult"
):
    """Background task –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤"""
    try:
        # –û–±—â–∏–π summary
        summary_text = f"""
## ü§ñ Code Review Summary

**Quality Score**: {review.summary.overall_quality_score}/100

### Issues Found
- Total: {review.summary.total_issues}
- Critical: {review.summary.critical_issues}

### Refactoring Suggestions
{review.summary.refactoring_suggestions} opportunities identified

### Recommendations
{chr(10).join(f"- {rec}" for rec in review.recommendations[:5])}
"""
        gitlab_service.add_mr_note(project_id, mr_iid, summary_text)
        
        # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ issues
        for issue in review.issues[:20]:  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            comment_text = f"""
**{issue.severity.upper()}** - {issue.category}

{issue.message}

{f"üí° Suggestion: {issue.suggestion}" if issue.suggestion else ""}
"""
            gitlab_service.add_mr_comment(
                project_id, mr_iid,
                issue.file, issue.line,
                comment_text
            )
        
        logger.info(f"Added {len(review.issues)} comments to MR !{mr_iid}")
        
    except Exception as e:
        logger.error(f"Failed to add comments: {e}")


@router.get("/health")
async def health_check():
    """Health check endpoint"""
    return {
        "status": "healthy",
        "service": "qwen-code-review",
        "qwen_api": settings.QWEN_API_URL
    }
```


### app/utils/validators.py (LangChain Integration)

```python
import re
from langchain_openai import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain.output_parsers import PydanticOutputParser
from pydantic import BaseModel, Field
from typing import List

from app.config import get_settings
from app.models import MRValidationResult

settings = get_settings()


class ValidationOutput(BaseModel):
    """Pydantic –º–æ–¥–µ–ª—å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ LLM"""
    has_jira_ticket: bool = Field(description="–ï—Å—Ç—å –ª–∏ JIRA —Ç–∏–∫–µ—Ç –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏")
    jira_ticket: str = Field(default="", description="–ù–æ–º–µ—Ä JIRA —Ç–∏–∫–µ—Ç–∞ –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω")
    has_meaningful_description: bool = Field(
        description="–°–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ–µ –ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ (>50 —Å–∏–º–≤–æ–ª–æ–≤, –Ω–µ template)"
    )
    validation_errors: List[str] = Field(
        default_factory=list,
        description="–°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"
    )
    should_draft: bool = Field(
        description="–ù—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ MR –≤ Draft"
    )
    score: int = Field(
        ge=0, le=100,
        description="–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ MR (0-100)"
    )


class MRValidator:
    def __init__(self):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ –º–æ–¥–µ–ª—å Qwen –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        self.llm = ChatOpenAI(
            base_url=settings.QWEN_API_URL,
            api_key=settings.QWEN_API_KEY,
            model=settings.QWEN_MODEL_NAME,
            temperature=0.1
        )
        
        self.output_parser = PydanticOutputParser(pydantic_object=ValidationOutput)
        
        self.prompt = ChatPromptTemplate.from_messages([
            ("system", """–¢—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä Merge Request. –ü—Ä–æ–≤–µ—Ä—å MR –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±–∞–∑–æ–≤—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –∫–∞—á–µ—Å—Ç–≤–∞.

–ö—Ä–∏—Ç–µ—Ä–∏–∏:
1. **JIRA —Ç–∏–∫–µ—Ç**: –í –Ω–∞–∑–≤–∞–Ω–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–æ–º–µ—Ä —Ç–∏–∫–µ—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–∞ PROJ-123, ABC-456 –∏ —Ç.–¥.
2. **–û–ø–∏—Å–∞–Ω–∏–µ**: –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–º (>50 —Å–∏–º–≤–æ–ª–æ–≤), –Ω–µ —à–∞–±–ª–æ–Ω–Ω—ã–º, –æ–±—ä—è—Å–Ω—è—é—â–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è

{format_instructions}
"""),
            ("user", """–ü—Ä–æ–≤–µ—Ä—å —Å–ª–µ–¥—É—é—â–∏–π Merge Request:

**Title**: {title}
**Description**: {description}
**Source Branch**: {source_branch}
**Target Branch**: {target_branch}
**Author**: {author}

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ –≤–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏.""")
        ])
    
    async def validate(
        self,
        title: str,
        description: str,
        source_branch: str,
        target_branch: str,
        author: str
    ) -> MRValidationResult:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è MR —á–µ—Ä–µ–∑ LangChain"""
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
        messages = self.prompt.format_messages(
            title=title,
            description=description,
            source_branch=source_branch,
            target_branch=target_branch,
            author=author,
            format_instructions=self.output_parser.get_format_instructions()
        )
        
        # –í—ã–∑—ã–≤–∞–µ–º LLM
        response = await self.llm.ainvoke(messages)
        
        # –ü–∞—Ä—Å–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        validation_output: ValidationOutput = self.output_parser.parse(
            response.content
        )
        
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ MRValidationResult
        return MRValidationResult(
            is_valid=len(validation_output.validation_errors) == 0,
            validation_errors=validation_output.validation_errors,
            jira_ticket=validation_output.jira_ticket if validation_output.has_jira_ticket else None,
            has_meaningful_description=validation_output.has_meaningful_description,
            should_draft=validation_output.should_draft,
            score=validation_output.score
        )
```


### app/main.py

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
import logging

from app.config import get_settings
from app.api import routes

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s"
)

settings = get_settings()

app = FastAPI(
    title=settings.APP_NAME,
    version=settings.APP_VERSION,
    description="AI-powered code review service using Qwen3-Coder"
)

# CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º routes
app.include_router(routes.router, prefix="/api/v1", tags=["review"])

@app.get("/")
async def root():
    return {
        "service": settings.APP_NAME,
        "version": settings.APP_VERSION,
        "status": "running"
    }
```


### Dockerfile

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN apt-get update && apt-get install -y \
    git \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Python dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥
COPY app/ ./app/

# –°–æ–∑–¥–∞–µ–º non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RUN useradd -m -u 1000 appuser && chown -R appuser:appuser /app
USER appuser

EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```


### docker-compose.yml (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```yaml
version: '3.8'

services:
  qwen-api:
    image: vllm/vllm-openai:latest
    command:
      - --model
      - Qwen/Qwen3-Coder-14B-Instruct-GPTQ-Int4
      - --host
      - 0.0.0.0
      - --port
      - "8000"
      - --max-model-len
      - "32768"
    ports:
      - "8000:8000"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    volumes:
      - huggingface-cache:/root/.cache/huggingface

  review-service:
    build: .
    ports:
      - "8001:8000"
    environment:
      - QWEN_API_URL=http://qwen-api:8000/v1
      - GITLAB_URL=${GITLAB_URL}
      - GITLAB_TOKEN=${GITLAB_TOKEN}
    depends_on:
      - qwen-api
    volumes:
      - ./app:/app/app

volumes:
  huggingface-cache:
```


## n8n Workflow

### –ü–æ–ª–Ω—ã–π Workflow —Å LangChain –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

```json
{
  "name": "Code Review with Validation",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "gitlab-mr-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook",
      "name": "GitLab Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.body.object_attributes.action }}",
              "operation": "equals",
              "value2": "open"
            }
          ]
        }
      },
      "id": "filter-mr-open",
      "name": "IF - MR Opened",
      "type": "n8n-nodes-base.if",
      "position": [450, 300]
    },
    {
      "parameters": {
        "url": "http://review-service.ai-services:8000/api/v1/validate-mr",
        "method": "POST",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  title: $json.body.object_attributes.title,\n  description: $json.body.object_attributes.description,\n  source_branch: $json.body.object_attributes.source_branch,\n  target_branch: $json.body.object_attributes.target_branch,\n  author: $json.body.user.username\n}) }}",
        "options": {}
      },
      "id": "validate-mr",
      "name": "HTTP - Validate MR",
      "type": "n8n-nodes-base.httpRequest",
      "position": [650, 200]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.is_valid }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-validation",
      "name": "IF - Validation Passed",
      "type": "n8n-nodes-base.if",
      "position": [850, 200]
    },
    {
      "parameters": {
        "url": "http://review-service.ai-services:8000/api/v1/review",
        "method": "POST",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  project_id: $('GitLab Webhook').item.json.body.project.id,\n  merge_request_iid: $('GitLab Webhook').item.json.body.object_attributes.iid,\n  create_fix_mr: true,\n  add_comments: true\n}) }}",
        "options": {
          "timeout": 300000
        }
      },
      "id": "code-review",
      "name": "HTTP - Code Review",
      "type": "n8n-nodes-base.httpRequest",
      "position": [1050, 100]
    },
    {
      "parameters": {
        "resource": "issue",
        "operation": "update",
        "project": "={{ $('GitLab Webhook').item.json.body.project.id }}",
        "issueNumber": "={{ $('GitLab Webhook').item.json.body.object_attributes.iid }}",
        "updateFields": {
          "state_event": "reopen",
          "title": "=Draft: {{ $('GitLab Webhook').item.json.body.object_attributes.title }}"
        }
      },
      "id": "set-draft",
      "name": "GitLab - Set Draft",
      "type": "n8n-nodes-base.gitlab",
      "position": [1050, 300]
    },
    {
      "parameters": {
        "resource": "issue",
        "operation": "createComment",
        "project": "={{ $('GitLab Webhook').item.json.body.project.id }}",
        "issueNumber": "={{ $('GitLab Webhook').item.json.body.object_attributes.iid }}",
        "body": "=‚ö†Ô∏è **MR Validation Failed**\n\n{{ $json.validation_errors.join('\\n') }}\n\n**Score**: {{ $json.score }}/100\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∑–∞–º–µ—á–∞–Ω–∏—è."
      },
      "id": "add-validation-comment",
      "name": "GitLab - Add Validation Comment",
      "type": "n8n-nodes-base.gitlab",
      "position": [1250, 300]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.review.summary.critical_issues }}",
              "operation": "largerEqual",
              "value2": 1
            }
          ]
        }
      },
      "id": "check-critical",
      "name": "IF - Has Critical Issues",
      "type": "n8n-nodes-base.if",
      "position": [1250, 100]
    },
    {
      "parameters": {
        "channel": "#code-reviews",
        "text": "=üö® **Critical Issues Found**\n\nMR: {{ $('GitLab Webhook').item.json.body.object_attributes.title }}\nAuthor: {{ $('GitLab Webhook').item.json.body.user.username }}\n\n**Issues**: {{ $json.review.summary.total_issues }}\n**Critical**: {{ $json.review.summary.critical_issues }}\n**Quality Score**: {{ $json.review.summary.overall_quality_score }}/100\n\n{{ $json.review.fix_mr_url ? '‚úÖ Fix MR created: ' + $json.review.fix_mr_url : '' }}\n\n[View MR]({{ $('GitLab Webhook').item.json.body.object_attributes.url }})"
      },
      "id": "slack-critical",
      "name": "Slack - Notify Critical",
      "type": "n8n-nodes-base.slack",
      "position": [1450, 50]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({\n  status: 'success',\n  validation_passed: $('IF - Validation Passed').item.json.is_valid,\n  review_completed: true,\n  quality_score: $('HTTP - Code Review').item.json.review?.summary?.overall_quality_score || 0\n}) }}"
      },
      "id": "respond",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1650, 200]
    }
  ],
  "connections": {
    "GitLab Webhook": {
      "main": [[{"node": "IF - MR Opened", "type": "main", "index": 0}]]
    },
    "IF - MR Opened": {
      "main": [[{"node": "HTTP - Validate MR", "type": "main", "index": 0}]]
    },
    "HTTP - Validate MR": {
      "main": [[{"node": "IF - Validation Passed", "type": "main", "index": 0}]]
    },
    "IF - Validation Passed": {
      "main": [
        [{"node": "HTTP - Code Review", "type": "main", "index": 0}],
        [
          {"node": "GitLab - Set Draft", "type": "main", "index": 0}
        ]
      ]
    },
    "HTTP - Code Review": {
      "main": [[{"node": "IF - Has Critical Issues", "type": "main", "index": 0}]]
    },
    "GitLab - Set Draft": {
      "main": [[{"node": "GitLab - Add Validation Comment", "type": "main", "index": 0}]]
    },
    "GitLab - Add Validation Comment": {
      "main": [[{"node": "Respond to Webhook", "type": "main", "index": 0}]]
    },
    "IF - Has Critical Issues": {
      "main": [
        [{"node": "Slack - Notify Critical", "type": "main", "index": 0}],
        [{"node": "Respond to Webhook", "type": "main", "index": 0}]
      ]
    },
    "Slack - Notify Critical": {
      "main": [[{"node": "Respond to Webhook", "type": "main", "index": 0}]]
    }
  }
}
```


## API –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### `/api/v1/validate-mr` (POST)

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```json
{
  "title": "PROJ-123: Add user authentication",
  "description": "Implemented JWT-based authentication with refresh tokens...",
  "source_branch": "feature/auth",
  "target_branch": "develop",
  "author": "developer1"
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```json
{
  "is_valid": true,
  "validation_errors": [],
  "jira_ticket": "PROJ-123",
  "has_meaningful_description": true,
  "should_draft": false,
  "score": 85
}
```


### `/api/v1/review` (POST)

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```json
{
  "project_id": "12345",
  "merge_request_iid": 42,
  "create_fix_mr": true,
  "add_comments": true
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```json
{
  "status": "success",
  "message": "Review completed successfully in 45.23s",
  "review": {
    "summary": {
      "total_files": 8,
      "total_issues": 12,
      "critical_issues": 2,
      "refactoring_suggestions": 3,
      "overall_quality_score": 75
    },
    "issues": [...],
    "refactorings": [...],
    "comments": [...],
    "recommendations": [...],
    "fix_mr_url": "https://gitlab.com/project/merge_requests/43",
    "fix_mr_iid": 43
  },
  "processing_time": 45.23,
  "timestamp": "2025-11-01T02:00:00Z"
}
```


## K8s Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: qwen-review-service
  namespace: ai-services
spec:
  replicas: 2
  selector:
    matchLabels:
      app: qwen-review
  template:
    metadata:
      labels:
        app: qwen-review
    spec:
      containers:
      - name: api
        image: your-registry/qwen-review-service:latest
        ports:
        - containerPort: 8000
        env:
        - name: QWEN_API_URL
          value: "http://qwen-coder-api:8000/v1"
        - name: GITLAB_URL
          valueFrom:
            secretKeyRef:
              name: gitlab-creds
              key: url
        - name: GITLAB_TOKEN
          valueFrom:
            secretKeyRef:
              name: gitlab-creds
              key: token
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /api/v1/health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: review-service
  namespace: ai-services
spec:
  selector:
    app: qwen-review
  ports:
  - port: 8000
    targetPort: 8000
  type: ClusterIP
```


## –ò—Ç–æ–≥–æ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è:**

‚úÖ **Python + FastAPI** - –ø—Ä–æ—Å—Ç–æ—Ç–∞, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚úÖ **LangChain –≤–∞–ª–∏–¥–∞—Ü–∏—è** - —É–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ MR –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π MR —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏** - –≤ –∏—Å—Ö–æ–¥–Ω—É—é feature –≤–µ—Ç–∫—É
‚úÖ **REST API** - –ø—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n
‚úÖ **K8s ready** - –≥–æ—Ç–æ–≤–æ –∫ production deployment
‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - background tasks –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
‚úÖ **Structured logging** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ debugging

–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é! –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –∫–∞–∫–∏–º-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º?

---

# query_model - –∑–∞–ø—Ä–æ—Å reviewer –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫ CLI, –∞ –Ω–µ –º–æ–¥–µ–ª–∏. –ò–ª–∏ —è —á—Ç–æ —Ç–æ –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞—é ?

–í CLI –º–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª—å. –Ω–æ –∏  rules –ø–æ–¥ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. —Ñ–æ–∫—É—Å –Ω–∞ java (springboot ).
–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ langchain - –∏–º–µ–ª–∞—Å—å –≤ –≤–∏–¥—É langchain code –Ω–æ–¥–∞ –≤ n8n.  –í–º–µ—Å—Ç–æ slack - –ø–∏—Å—å–º–æ –Ω–∞ –ø–æ—á—Ç—É.

–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã! –Ø –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º:

1. **Qwen Code CLI** - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –º–æ–¥–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ API
2. **Rules –¥–ª—è Java/Spring Boot** - –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é CLI
3. **LangChain Code Node –≤ n8n** - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
4. **Email –≤–º–µ—Å—Ç–æ Slack**

–ò—Å–ø—Ä–∞–≤–ª—è—é —Ä–µ—à–µ–Ω–∏–µ:

## –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   GitLab     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   n8n Workflow  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ LangChain Code   ‚îÇ
‚îÇ   Webhook    ‚îÇ     ‚îÇ                 ‚îÇ     ‚îÇ   Node (n8n)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ                         ‚îÇ
                            ‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ                    ‚îÇ          ‚îÇ
                            ‚ñº                Valid?      Invalid?
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ              ‚îÇ
                     ‚îÇ  Review API  ‚îÇ       ‚îÇ              ‚ñº
                     ‚îÇ  (Python)    ‚îÇ       ‚îÇ         Set Draft +
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ         Send Email
                            ‚îÇ               ‚îÇ
                            ‚ñº               ‚îÇ
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
                     ‚îÇ  Qwen Code   ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ     CLI      ‚îÇ
                     ‚îÇ  (Process)   ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ  Qwen Model  ‚îÇ
                     ‚îÇ   (vLLM)     ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ  GitLab API  ‚îÇ
                     ‚îÇ  Create MR   ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```


## 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Qwen Code CLI —Å Java Rules

### .qwen-code/config.yaml

```yaml
# Qwen Code –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
model:
  provider: openai  # –ò—Å–ø–æ–ª—å–∑—É–µ–º OpenAI-compatible API
  base_url: http://qwen-coder-api:8000/v1
  api_key: dummy-key
  model_name: Qwen/Qwen3-Coder-14B-Instruct-GPTQ-Int4
  temperature: 0.3
  max_tokens: 8192

# –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è Java/Spring Boot
languages:
  java:
    enabled: true
    rules:
      # Code Quality Rules
      - name: avoid-god-classes
        severity: high
        description: "–ö–ª–∞—Å—Å –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 500 —Å—Ç—Ä–æ–∫"
        pattern: "class_lines > 500"
      
      - name: max-method-length
        severity: medium
        description: "–ú–µ—Ç–æ–¥ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å—Ç—Ä–æ–∫"
        pattern: "method_lines > 50"
      
      - name: cyclomatic-complexity
        severity: high
        description: "–¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å > 10"
        pattern: "complexity > 10"
      
      # Spring Boot Specific
      - name: service-layer-transaction
        severity: high
        description: "@Service –∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @Transactional"
        pattern: |
          class has @Service annotation
          AND has methods that modify data
          AND missing @Transactional
      
      - name: repository-interface
        severity: critical
        description: "Repository –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–º JpaRepository"
        pattern: |
          class name ends with Repository
          AND not interface
          OR not extends JpaRepository
      
      - name: rest-controller-best-practices
        severity: medium
        description: "@RestController –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å @RequestMapping –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞"
        pattern: |
          class has @RestController
          AND missing @RequestMapping at class level
      
      - name: dto-validation
        severity: high
        description: "DTO –∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å validation –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏"
        pattern: |
          class name ends with DTO or Request or Response
          AND has fields
          AND missing @Valid or @NotNull annotations
      
      # Security Rules
      - name: sql-injection-prevention
        severity: critical
        description: "–ò—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –∏–∑–±–µ–≥–∞–π –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ SQL"
        pattern: |
          string concatenation in SQL query
          OR dynamic query without parameters
      
      - name: password-encoding
        severity: critical
        description: "–ü–∞—Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ PasswordEncoder"
        pattern: |
          field name contains password
          AND not using PasswordEncoder
      
      - name: endpoint-security
        severity: high
        description: "REST endpoints –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å @PreAuthorize –∏–ª–∏ @Secured"
        pattern: |
          method has @GetMapping or @PostMapping
          AND missing security annotations
          AND not public endpoint
      
      # Performance Rules
      - name: n-plus-one-query
        severity: high
        description: "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è N+1 –ø—Ä–æ–±–ª–µ–º–∞ –≤ JPA"
        pattern: |
          @OneToMany or @ManyToMany
          AND missing fetch = FetchType.LAZY
          OR missing @EntityGraph
      
      - name: inefficient-collection-iteration
        severity: medium
        description: "–ò—Å–ø–æ–ª—å–∑—É–π stream API –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–æ–≤ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π"
        pattern: |
          for loop over collection
          AND could be replaced with stream
      
      # SOLID Principles
      - name: single-responsibility
        severity: medium
        description: "–ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"
        pattern: |
          class has multiple unrelated methods
          OR class name contains 'And' or 'Manager' or 'Helper'
      
      - name: dependency-injection
        severity: high
        description: "–ò—Å–ø–æ–ª—å–∑—É–π constructor injection –≤–º–µ—Å—Ç–æ field injection"
        pattern: |
          @Autowired on field
          instead of constructor parameter
      
      - name: interface-segregation
        severity: low
        description: "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –º–µ—Ç–æ–¥–æ–≤"
        pattern: "interface methods > 10"
      
      # Exception Handling
      - name: catch-specific-exceptions
        severity: medium
        description: "–ò–∑–±–µ–≥–∞–π catch (Exception e), –ª–æ–≤–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è"
        pattern: "catch Exception without specific type"
      
      - name: custom-exception-handler
        severity: high
        description: "–ò—Å–ø–æ–ª—å–∑—É–π @ControllerAdvice –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π"
        pattern: |
          @RestController method throws exception
          AND no @ExceptionHandler in project
      
      # Logging
      - name: use-slf4j
        severity: low
        description: "–ò—Å–ø–æ–ª—å–∑—É–π SLF4J –≤–º–µ—Å—Ç–æ System.out"
        pattern: |
          System.out.println or System.err.println
          instead of logger
      
      - name: log-levels
        severity: low
        description: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"
        pattern: |
          logger.error without exception
          OR logger.debug in production code path
      
      # Testing
      - name: test-coverage
        severity: medium
        description: "–ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ç–µ—Å—Ç—ã"
        pattern: |
          public method in service or controller
          AND no corresponding test method
      
      - name: mock-external-dependencies
        severity: high
        description: "–í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ç–µ—Å—Ç–∞—Ö"
        pattern: |
          test uses real database or HTTP client
          without @MockBean

    patterns:
      # Anti-patterns –¥–ª—è Spring Boot
      anti_patterns:
        - name: service-calling-service
          description: "Service –Ω–µ –¥–æ–ª–∂–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞—Ç—å –¥—Ä—É–≥–æ–π Service (–Ω–∞—Ä—É—à–µ–Ω–∏–µ —Å–ª–æ–µ–≤)"
          severity: medium
        
        - name: entity-as-dto
          description: "–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π JPA Entity –∫–∞–∫ DTO –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö"
          severity: high
        
        - name: business-logic-in-controller
          description: "–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ Service, –∞ –Ω–µ –≤ Controller"
          severity: high
        
        - name: static-service-methods
          description: "Service –º–µ—Ç–æ–¥—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å static"
          severity: medium

    best_practices:
      # Spring Boot Best Practices
      - "–ò—Å–ø–æ–ª—å–∑—É–π @Slf4j (Lombok) –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"
      - "–í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—ã–Ω–æ—Å–∏ –≤ application.yml"
      - "–ò—Å–ø–æ–ª—å–∑—É–π @ConfigurationProperties –≤–º–µ—Å—Ç–æ @Value –¥–ª—è –≥—Ä—É–ø–ø—ã —Å–≤–æ–π—Å—Ç–≤"
      - "–°–æ–∑–¥–∞–≤–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã–µ DTO –¥–ª—è request/response"
      - "–ò—Å–ø–æ–ª—å–∑—É–π MapStruct –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ Entity <-> DTO"
      - "–ü—Ä–∏–º–µ–Ω—è–π –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è —Å–ø–∏—Å–∫–æ–≤—ã—Ö endpoint-–æ–≤"
      - "–í–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–π API (/api/v1/...)"
      - "–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π API —á–µ—Ä–µ–∑ OpenAPI/Swagger"
      - "–ò—Å–ø–æ–ª—å–∑—É–π validation groups –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤"
      - "–†–µ–∞–ª–∏–∑—É–π proper exception handling —á–µ—Ä–µ–∑ @ControllerAdvice"

# Review –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
review:
  focus_areas:
    - code_quality
    - security
    - performance
    - best_practices
    - documentation
  
  auto_fix:
    enabled: true
    safe_fixes_only: true
    categories:
      - formatting
      - imports
      - simple_refactoring
  
  comment_style:
    language: ru
    format: markdown
    include_examples: true
  
  refactoring:
    min_impact: medium  # –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Ç–æ–ª—å–∫–æ medium/high impact —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
    complexity_threshold: 10

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitLab
gitlab:
  comment_format: |
    **{severity}** - {category}
    
    {message}
    
    {suggestion}
    
    {code_example}
  
  summary_format: |
    ## ü§ñ Qwen Code Review Summary
    
    **Quality Score**: {score}/100
    **Language**: Java (Spring Boot)
    
    ### Issues
    - Total: {total_issues}
    - Critical: {critical}
    - High: {high}
    - Medium: {medium}
    
    ### Refactoring Opportunities
    {refactoring_count} identified
    
    ### Recommendations
    {recommendations}
```


## 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Python Service

### app/services/qwen_reviewer.py (–ò–°–ü–†–ê–í–õ–ï–ù–û)

```python
import json
import subprocess
import tempfile
import os
from pathlib import Path
from typing import Dict, List, Optional
import logging
import yaml

from app.config import get_settings
from app.models import ReviewResult, ReviewSummary, Issue, Refactoring, CodeComment

logger = logging.getLogger(__name__)
settings = get_settings()


class QwenCodeReviewer:
    """
    Reviewer –∏—Å–ø–æ–ª—å–∑—É—è Qwen Code CLI (–Ω–µ –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –º–æ–¥–µ–ª–∏)
    """
    
    def __init__(self):
        self.config_path = self._setup_qwen_config()
    
    def _setup_qwen_config(self) -> str:
        """–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è Qwen Code CLI"""
        config_dir = Path.home() / ".qwen-code"
        config_dir.mkdir(exist_ok=True)
        
        config_path = config_dir / "config.yaml"
        
        config = {
            "model": {
                "provider": "openai",
                "base_url": settings.QWEN_API_URL,
                "api_key": settings.QWEN_API_KEY,
                "model_name": settings.QWEN_MODEL_NAME,
                "temperature": settings.QWEN_TEMPERATURE,
                "max_tokens": settings.QWEN_MAX_TOKENS
            },
            "languages": {
                "java": {
                    "enabled": True,
                    # Rules –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
                    "rules_file": str(config_dir / "java-spring-rules.yaml")
                }
            },
            "review": {
                "focus_areas": [
                    "code_quality",
                    "security",
                    "performance",
                    "best_practices",
                    "documentation"
                ],
                "auto_fix": {
                    "enabled": True,
                    "safe_fixes_only": True
                },
                "comment_style": {
                    "language": "ru",
                    "format": "markdown"
                }
            }
        }
        
        with open(config_path, 'w', encoding='utf-8') as f:
            yaml.dump(config, f, allow_unicode=True)
        
        # –ö–æ–ø–∏—Ä—É–µ–º Java rules
        self._setup_java_rules(config_dir / "java-spring-rules.yaml")
        
        logger.info(f"Qwen Code config created at {config_path}")
        return str(config_path)
    
    def _setup_java_rules(self, rules_path: Path):
        """–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–ª—è Java/Spring Boot"""
        # –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ rules –∏–∑ config.yaml –≤—ã—à–µ
        # –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä
        rules = {
            "rules": [
                {
                    "name": "avoid-god-classes",
                    "severity": "high",
                    "description": "–ö–ª–∞—Å—Å –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 500 —Å—Ç—Ä–æ–∫",
                },
                {
                    "name": "service-layer-transaction",
                    "severity": "high",
                    "description": "@Service –∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @Transactional"
                },
                {
                    "name": "repository-interface",
                    "severity": "critical",
                    "description": "Repository –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º"
                },
                {
                    "name": "sql-injection-prevention",
                    "severity": "critical",
                    "description": "–ò—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã"
                },
                {
                    "name": "dependency-injection",
                    "severity": "high",
                    "description": "–ò—Å–ø–æ–ª—å–∑—É–π constructor injection"
                }
            ],
            "anti_patterns": [
                "service-calling-service",
                "entity-as-dto",
                "business-logic-in-controller"
            ],
            "best_practices": [
                "–ò—Å–ø–æ–ª—å–∑—É–π @Slf4j –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è",
                "–°–æ–∑–¥–∞–≤–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã–µ DTO –¥–ª—è request/response",
                "–ü—Ä–∏–º–µ–Ω—è–π –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è —Å–ø–∏—Å–∫–æ–≤—ã—Ö endpoint-–æ–≤"
            ]
        }
        
        with open(rules_path, 'w', encoding='utf-8') as f:
            yaml.dump(rules, f, allow_unicode=True)
    
    async def review_merge_request(
        self,
        diff: str,
        title: str,
        description: str,
        source_branch: str,
        target_branch: str,
        files_changed: List[str]
    ) -> ReviewResult:
        """
        –í—ã–ø–æ–ª–Ω–∏—Ç—å review —á–µ—Ä–µ–∑ Qwen Code CLI
        """
        logger.info(f"Starting CLI review for: {title}")
        
        # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã
        with tempfile.TemporaryDirectory() as temp_dir:
            temp_path = Path(temp_dir)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º diff
            diff_file = temp_path / "changes.diff"
            diff_file.write_text(diff, encoding='utf-8')
            
            # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π —Ñ–∞–π–ª —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
            context_file = temp_path / "context.json"
            context = {
                "title": title,
                "description": description,
                "source_branch": source_branch,
                "target_branch": target_branch,
                "files_changed": files_changed,
                "language": "java",
                "framework": "spring-boot"
            }
            context_file.write_text(json.dumps(context, ensure_ascii=False), encoding='utf-8')
            
            # –í—ã–∑—ã–≤–∞–µ–º Qwen Code CLI
            result = await self._run_qwen_cli(
                diff_file=str(diff_file),
                context_file=str(context_file),
                output_dir=str(temp_path)
            )
            
            # –ü–∞—Ä—Å–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            return self._parse_cli_output(result)
    
    async def _run_qwen_cli(
        self,
        diff_file: str,
        context_file: str,
        output_dir: str
    ) -> Dict:
        """
        –ó–∞–ø—É—Å–∫ Qwen Code CLI
        
        –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∞—è:
        qwen code-review \
            --diff changes.diff \
            --context context.json \
            --config ~/.qwen-code/config.yaml \
            --language java \
            --output review-result.json \
            --format json
        """
        
        output_file = Path(output_dir) / "review-result.json"
        
        cmd = [
            "qwen",
            "code-review",
            "--diff", diff_file,
            "--context", context_file,
            "--config", self.config_path,
            "--language", "java",
            "--framework", "spring-boot",
            "--output", str(output_file),
            "--format", "json",
            "--verbose"
        ]
        
        logger.info(f"Running CLI command: {' '.join(cmd)}")
        
        try:
            # –ó–∞–ø—É—Å–∫–∞–µ–º CLI –ø—Ä–æ—Ü–µ—Å—Å
            process = await asyncio.create_subprocess_exec(
                *cmd,
                stdout=asyncio.subprocess.PIPE,
                stderr=asyncio.subprocess.PIPE,
                env={
                    **os.environ,
                    "QWEN_CONFIG": self.config_path,
                    "PYTHONUNBUFFERED": "1"
                }
            )
            
            stdout, stderr = await process.communicate()
            
            if process.returncode != 0:
                logger.error(f"CLI failed: {stderr.decode()}")
                raise RuntimeError(f"Qwen CLI failed: {stderr.decode()}")
            
            logger.info(f"CLI output: {stdout.decode()}")
            
            # –ß–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ —Ñ–∞–π–ª–∞
            if not output_file.exists():
                raise RuntimeError("CLI did not produce output file")
            
            with open(output_file, 'r', encoding='utf-8') as f:
                result = json.load(f)
            
            return result
            
        except Exception as e:
            logger.error(f"Error running Qwen CLI: {e}", exc_info=True)
            raise
    
    def _parse_cli_output(self, cli_result: Dict) -> ReviewResult:
        """–ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ CLI –≤ ReviewResult"""
        
        return ReviewResult(
            summary=ReviewSummary(
                total_files=cli_result.get("summary", {}).get("total_files", 0),
                total_issues=cli_result.get("summary", {}).get("total_issues", 0),
                critical_issues=cli_result.get("summary", {}).get("critical_issues", 0),
                refactoring_suggestions=len(cli_result.get("refactorings", [])),
                overall_quality_score=cli_result.get("summary", {}).get("quality_score", 0)
            ),
            issues=[
                Issue(**issue) for issue in cli_result.get("issues", [])
            ],
            refactorings=[
                Refactoring(**ref) for ref in cli_result.get("refactorings", [])
            ],
            comments=[
                CodeComment(**comment) for comment in cli_result.get("comments", [])
            ],
            recommendations=cli_result.get("recommendations", [])
        )


# –î–æ–±–∞–≤–ª—è–µ–º asyncio import
import asyncio
```


## 3. n8n Workflow —Å LangChain Code Node

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Workflow

```json
{
  "name": "MR Review with Validation",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "gitlab-mr",
        "responseMode": "responseNode"
      },
      "id": "webhook",
      "name": "GitLab Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.body.object_attributes.action }}",
              "value2": "open"
            }
          ]
        }
      },
      "id": "filter-open",
      "name": "IF MR Opened",
      "type": "n8n-nodes-base.if",
      "position": [450, 300]
    },
    {
      "parameters": {
        "jsCode": "// LangChain Code –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ MR\nconst title = $input.item.json.body.object_attributes.title;\nconst description = $input.item.json.body.object_attributes.description || '';\n\n// –†–µ–≥—É–ª—è—Ä–∫–∞ –¥–ª—è JIRA —Ç–∏–∫–µ—Ç–∞\nconst jiraPattern = /([A-Z]+-\\d+)/;\nconst jiraMatch = title.match(jiraPattern);\n\nconst hasJiraTicket = !!jiraMatch;\nconst jiraTicket = jiraMatch ? jiraMatch[1] : null;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ description\nconst hasDescription = description.length > 50;\nconst isNotTemplate = !description.includes('<!--') && \n                      !description.includes('TODO') &&\n                      !description.toLowerCase().includes('fill this');\n\nconst hasMeaningfulDescription = hasDescription && isNotTemplate;\n\n// –í–∞–ª–∏–¥–∞—Ü–∏—è\nconst validationErrors = [];\n\nif (!hasJiraTicket) {\n  validationErrors.push('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ–º–µ—Ä JIRA —Ç–∏–∫–µ—Ç–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ (—Ñ–æ—Ä–º–∞—Ç: PROJ-123)');\n}\n\nif (!hasMeaningfulDescription) {\n  if (!hasDescription) {\n    validationErrors.push('‚ùå –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ (–º–∏–Ω–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤)');\n  }\n  if (!isNotTemplate) {\n    validationErrors.push('‚ùå –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç template –∑–∞–≥–ª—É—à–∫–∏');\n  }\n}\n\n// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏\nif (title.toLowerCase().includes('wip') || title.toLowerCase().includes('draft')) {\n  validationErrors.push('‚ö†Ô∏è MR –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ WIP/Draft –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏');\n}\n\n// –ü–æ–¥—Å—á–µ—Ç score\nlet score = 100;\nif (!hasJiraTicket) score -= 30;\nif (!hasMeaningfulDescription) score -= 40;\nif (validationErrors.length > 2) score -= 20;\n\nconst isValid = validationErrors.length === 0;\nconst shouldDraft = !isValid;\n\nreturn {\n  is_valid: isValid,\n  validation_errors: validationErrors,\n  jira_ticket: jiraTicket,\n  has_meaningful_description: hasMeaningfulDescription,\n  should_draft: shouldDraft,\n  score: Math.max(0, score),\n  mr_title: title,\n  mr_iid: $input.item.json.body.object_attributes.iid,\n  project_id: $input.item.json.body.project.id,\n  author: $input.item.json.body.user.username,\n  mr_url: $input.item.json.body.object_attributes.url\n};"
      },
      "id": "langchain-validate",
      "name": "LangChain Code - Validate MR",
      "type": "n8n-nodes-base.code",
      "position": [650, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.is_valid }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-valid",
      "name": "IF Valid",
      "type": "n8n-nodes-base.if",
      "position": [850, 300]
    },
    {
      "parameters": {
        "url": "http://review-service.ai-services:8000/api/v1/review",
        "method": "POST",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  project_id: $json.project_id,\n  merge_request_iid: $json.mr_iid,\n  create_fix_mr: true,\n  add_comments: true\n}) }}",
        "options": {
          "timeout": 300000
        }
      },
      "id": "http-review",
      "name": "HTTP Request - Code Review",
      "type": "n8n-nodes-base.httpRequest",
      "position": [1050, 200]
    },
    {
      "parameters": {
        "resource": "issue",
        "operation": "update",
        "project": "={{ $json.project_id }}",
        "issueNumber": "={{ $json.mr_iid }}",
        "updateFields": {
          "title": "=Draft: {{ $json.mr_title }}"
        }
      },
      "id": "set-draft",
      "name": "GitLab - Set to Draft",
      "type": "n8n-nodes-base.gitlab",
      "position": [1050, 400],
      "credentials": {
        "gitlabApi": {
          "id": "1",
          "name": "GitLab API"
        }
      }
    },
    {
      "parameters": {
        "resource": "issue",
        "operation": "createComment",
        "project": "={{ $json.project_id }}",
        "issueNumber": "={{ $json.mr_iid }}",
        "body": "=## ‚ö†Ô∏è MR Validation Failed\n\n**Score**: {{ $json.score }}/100\n\n### –ü—Ä–æ–±–ª–µ–º—ã:\n{{ $json.validation_errors.join('\\n') }}\n\n---\n\n**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**\n1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä JIRA —Ç–∏–∫–µ—Ç–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ (—Ñ–æ—Ä–º–∞—Ç: `PROJ-123: –û–ø–∏—Å–∞–Ω–∏–µ`)\n2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ MR (–º–∏–Ω–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤):\n   - –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ?\n   - –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?\n   - –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å?\n\n–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ MR –∏–∑ Draft –∏ review –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."
      },
      "id": "add-validation-comment",
      "name": "GitLab - Add Validation Comment",
      "type": "n8n-nodes-base.gitlab",
      "position": [1250, 400],
      "credentials": {
        "gitlabApi": {
          "id": "1",
          "name": "GitLab API"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "code-review@company.com",
        "toEmail": "={{ $json.author }}@company.com",
        "subject": "=‚ö†Ô∏è MR Validation Failed: {{ $json.mr_title }}",
        "emailFormat": "html",
        "text": "=<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n    .header { background: #f44336; color: white; padding: 15px; border-radius: 5px; }\n    .score { font-size: 24px; font-weight: bold; margin: 15px 0; }\n    .errors { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0; }\n    .error-item { margin: 8px 0; }\n    .actions { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin: 15px 0; }\n    .btn { display: inline-block; background: #2196f3; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin-top: 10px; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h2>‚ö†Ô∏è MR Validation Failed</h2>\n    </div>\n    \n    <p><strong>MR:</strong> {{ $json.mr_title }}</p>\n    <p><strong>Author:</strong> {{ $json.author }}</p>\n    \n    <div class=\"score\">\n      Quality Score: {{ $json.score }}/100\n    </div>\n    \n    <div class=\"errors\">\n      <h3>–ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:</h3>\n      {{ $json.validation_errors.map(err => `<div class=\"error-item\">${err}</div>`).join('') }}\n    </div>\n    \n    <div class=\"actions\">\n      <h3>–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:</h3>\n      <ol>\n        <li>–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä JIRA —Ç–∏–∫–µ—Ç–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ (—Ñ–æ—Ä–º–∞—Ç: <code>PROJ-123: –û–ø–∏—Å–∞–Ω–∏–µ</code>)</li>\n        <li>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ MR (–º–∏–Ω–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤):\n          <ul>\n            <li>–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ?</li>\n            <li>–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?</li>\n            <li>–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å?</li>\n          </ul>\n        </li>\n      </ol>\n      <p>–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ MR –∏–∑ Draft - review –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>\n    </div>\n    \n    <a href=\"{{ $json.mr_url }}\" class=\"btn\">–û—Ç–∫—Ä—ã—Ç—å MR</a>\n  </div>\n</body>\n</html>"
      },
      "id": "send-email-invalid",
      "name": "Email - Validation Failed",
      "type": "n8n-nodes-base.emailSend",
      "position": [1450, 400],
      "credentials": {
        "smtp": {
          "id": "2",
          "name": "SMTP Account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.review.summary.critical_issues }}",
              "operation": "largerEqual",
              "value2": 1
            }
          ]
        }
      },
      "id": "check-critical",
      "name": "IF Critical Issues",
      "type": "n8n-nodes-base.if",
      "position": [1250, 200]
    },
    {
      "parameters": {
        "fromEmail": "code-review@company.com",
        "toEmail": "={{ $('GitLab Webhook').item.json.body.user.username }}@company.com",
        "subject": "=üö® Critical Issues in MR: {{ $('GitLab Webhook').item.json.body.object_attributes.title }}",
        "emailFormat": "html",
        "text": "=<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n    .container { max-width: 700px; margin: 0 auto; padding: 20px; }\n    .header { background: #d32f2f; color: white; padding: 20px; border-radius: 5px; }\n    .summary { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 5px; }\n    .stat { display: inline-block; margin: 10px 20px 10px 0; }\n    .stat-value { font-size: 32px; font-weight: bold; color: #d32f2f; }\n    .stat-label { color: #666; font-size: 14px; }\n    .issues { margin: 20px 0; }\n    .issue { background: white; border-left: 4px solid #d32f2f; padding: 15px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }\n    .issue-severity { font-weight: bold; color: #d32f2f; text-transform: uppercase; }\n    .fix-mr { background: #4caf50; color: white; padding: 20px; border-radius: 5px; margin: 20px 0; }\n    .btn { display: inline-block; background: #2196f3; color: white !important; padding: 12px 24px; text-decoration: none; border-radius: 5px; margin: 5px; }\n    .btn-success { background: #4caf50; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>üö® Critical Issues Found</h1>\n      <p style=\"margin: 5px 0;\">{{ $('GitLab Webhook').item.json.body.object_attributes.title }}</p>\n    </div>\n    \n    <div class=\"summary\">\n      <div class=\"stat\">\n        <div class=\"stat-value\">{{ $json.review.summary.overall_quality_score }}</div>\n        <div class=\"stat-label\">Quality Score</div>\n      </div>\n      <div class=\"stat\">\n        <div class=\"stat-value\">{{ $json.review.summary.total_issues }}</div>\n        <div class=\"stat-label\">Total Issues</div>\n      </div>\n      <div class=\"stat\">\n        <div class=\"stat-value\">{{ $json.review.summary.critical_issues }}</div>\n        <div class=\"stat-label\">Critical</div>\n      </div>\n      <div class=\"stat\">\n        <div class=\"stat-value\">{{ $json.review.summary.refactoring_suggestions }}</div>\n        <div class=\"stat-label\">Refactorings</div>\n      </div>\n    </div>\n    \n    <h2>Critical Issues:</h2>\n    <div class=\"issues\">\n      {{ $json.review.issues\n        .filter(i => i.severity === 'critical')\n        .slice(0, 5)\n        .map(issue => `\n          <div class=\"issue\">\n            <div class=\"issue-severity\">${issue.severity}</div>\n            <p><strong>${issue.file}:${issue.line}</strong></p>\n            <p>${issue.message}</p>\n            ${issue.suggestion ? `<p><em>üí° Suggestion: ${issue.suggestion}</em></p>` : ''}\n          </div>\n        `).join('') }}\n    </div>\n    \n    {{ $json.review.fix_mr_url ? `\n    <div class=\"fix-mr\">\n      <h3>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã!</h3>\n      <p>–°–æ–∑–¥–∞–Ω MR —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏.</p>\n      <a href=\"${$json.review.fix_mr_url}\" class=\"btn btn-success\">–û—Ç–∫—Ä—ã—Ç—å Fix MR</a>\n    </div>\n    ` : '' }}\n    \n    <div style=\"margin-top: 30px;\">\n      <a href=\"{{ $('GitLab Webhook').item.json.body.object_attributes.url }}\" class=\"btn\">–û—Ç–∫—Ä—ã—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π MR</a>\n    </div>\n    \n    <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 12px;\">\n      <p>Powered by Qwen Code Review Service</p>\n      <p>Language: Java (Spring Boot) | Framework Rules: Enabled</p>\n    </div>\n  </div>\n</body>\n</html>"
      },
      "id": "send-email-critical",
      "name": "Email - Critical Issues",
      "type": "n8n-nodes-base.emailSend",
      "position": [1450, 100],
      "credentials": {
        "smtp": {
          "id": "2",
          "name": "SMTP Account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "code-review@company.com",
        "toEmail": "={{ $('GitLab Webhook').item.json.body.user.username }}@company.com",
        "subject": "=‚úÖ Code Review Completed: {{ $('GitLab Webhook').item.json.body.object_attributes.title }}",
        "emailFormat": "html",
        "text": "=<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n    .container { max-width: 700px; margin: 0 auto; padding: 20px; }\n    .header { background: #4caf50; color: white; padding: 20px; border-radius: 5px; }\n    .summary { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 5px; }\n    .stat { display: inline-block; margin: 10px 20px 10px 0; }\n    .stat-value { font-size: 32px; font-weight: bold; color: #4caf50; }\n    .btn { display: inline-block; background: #2196f3; color: white !important; padding: 12px 24px; text-decoration: none; border-radius: 5px; margin: 5px; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>‚úÖ Code Review Completed</h1>\n      <p>{{ $('GitLab Webhook').item.json.body.object_attributes.title }}</p>\n    </div>\n    \n    <div class=\"summary\">\n      <div class=\"stat\">\n        <div class=\"stat-value\">{{ $json.review.summary.overall_quality_score }}</div>\n        <div class=\"stat-label\">Quality Score</div>\n      </div>\n      <div class=\"stat\">\n        <div class=\"stat-value\">{{ $json.review.summary.total_issues }}</div>\n        <div class=\"stat-label\">Issues</div>\n      </div>\n    </div>\n    \n    <a href=\"{{ $('GitLab Webhook').item.json.body.object_attributes.url }}\" class=\"btn\">View MR</a>\n  </div>\n</body>\n</html>"
      },
      "id": "send-email-success",
      "name": "Email - Review Success",
      "type": "n8n-nodes-base.emailSend",
      "position": [1450, 300],
      "credentials": {
        "smtp": {
          "id": "2",
          "name": "SMTP Account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({\n  status: 'completed',\n  validation_passed: $('LangChain Code - Validate MR').item.json.is_valid,\n  review_executed: $('LangChain Code - Validate MR').item.json.is_valid,\n  quality_score: $('HTTP Request - Code Review').item.json.review?.summary?.overall_quality_score || 0\n}) }}"
      },
      "id": "respond",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1650, 300]
    }
  ],
  "connections": {
    "GitLab Webhook": {
      "main": [[{"node": "IF MR Opened"}]]
    },
    "IF MR Opened": {
      "main": [[{"node": "LangChain Code - Validate MR"}]]
    },
    "LangChain Code - Validate MR": {
      "main": [[{"node": "IF Valid"}]]
    },
    "IF Valid": {
      "main": [
        [{"node": "HTTP Request - Code Review"}],
        [{"node": "GitLab - Set to Draft"}]
      ]
    },
    "HTTP Request - Code Review": {
      "main": [[{"node": "IF Critical Issues"}]]
    },
    "GitLab - Set to Draft": {
      "main": [[{"node": "GitLab - Add Validation Comment"}]]
    },
    "GitLab - Add Validation Comment": {
      "main": [[{"node": "Email - Validation Failed"}]]
    },
    "Email - Validation Failed": {
      "main": [[{"node": "Respond to Webhook"}]]
    },
    "IF Critical Issues": {
      "main": [
        [{"node": "Email - Critical Issues"}],
        [{"node": "Email - Review Success"}]
      ]
    },
    "Email - Critical Issues": {
      "main": [[{"node": "Respond to Webhook"}]]
    },
    "Email - Review Success": {
      "main": [[{"node": "Respond to Webhook"}]]
    }
  }
}
```


## 4. Dockerfile —Å Qwen Code CLI

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN apt-get update && apt-get install -y \
    git \
    curl \
    nodejs \
    npm \
    && rm -rf /var/lib/apt/lists/*

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Qwen Code CLI
RUN npm install -g @qwen-code/qwen-code

# Python dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Qwen
COPY .qwen-code/ /root/.qwen-code/

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY app/ ./app/

# Non-root user
RUN useradd -m -u 1000 appuser && \
    chown -R appuser:appuser /app && \
    mkdir -p /home/appuser/.qwen-code && \
    cp -r /root/.qwen-code/* /home/appuser/.qwen-code/ && \
    chown -R appuser:appuser /home/appuser/.qwen-code

USER appuser

EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```


## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞

```
1. GitLab Webhook ‚Üí n8n
2. n8n: LangChain Code Node ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è (JIRA, description)
3. –ï—Å–ª–∏ –ù–ï –≤–∞–ª–∏–¥–µ–Ω:
   - Set MR to Draft
   - Add GitLab comment
   - Send email (validation errors)
4. –ï—Å–ª–∏ –≤–∞–ª–∏–¥–µ–Ω:
   - HTTP Request ‚Üí Python Review Service
   - Service –≤—ã–∑—ã–≤–∞–µ—Ç Qwen Code CLI
   - CLI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Java/Spring Boot rules
   - CLI –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ Qwen –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ API
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å—è—Ç—Å—è
   - –°–æ–∑–¥–∞–µ—Ç—Å—è Fix MR –≤ –∏—Å—Ö–æ–¥–Ω—É—é –≤–µ—Ç–∫—É
   - Add comments to original MR
5. –ï—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ issues:
   - Send email (critical issues + fix MR link)
6. –ò–Ω–∞—á–µ:
   - Send email (success)
```

**–¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** CLI —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º review —Å —É—á–µ—Ç–æ–º Java/Spring Boot –ø—Ä–∞–≤–∏–ª. –ù—É–∂–Ω—ã –ª–∏ –µ—â—ë —É—Ç–æ—á–Ω–µ–Ω–∏—è?

---

# –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤–µ—Å—å –¥–∏–∞–ª–æ–≥, —É–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω—ã –Ω–∏–∫–∞–∫–∏–µ –≤–∞–∂–Ω—ã–µ  –¥–µ—Ç–∞–ª–∏. –°–æ–±–µ—Ä–∏ –≤—Å—ë —ç—Ç–æ –≤  –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–ø–∞–∫—É–π –≤ –∞—Ä—Ö–∏–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

–í–∞—à –ø—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–±—Ä–∞–Ω ‚Äî –≤—Å–µ –≤–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã:

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (self-hosted, GPU, on-prem, Java/Spring Boot, Qwen Code CLI —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏)
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: FastAPI REST API, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitLab, Qwen Code CLI –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å, –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ vLLM endpoint
- –í–∞–ª–∏–¥–∞—Ç–æ—Ä MR: LangChain code node –¥–ª—è –Ω–æ–¥—ã –≤ n8n workflow –ª–∏–±–æ Python-–≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è API/CLI (–ø—Ä–æ–≤–µ—Ä–∫–∞ JIRA/description)
- n8n workflow —Å –ø–æ—à–∞–≥–æ–≤–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π: —Ç—Ä–∏–≥–≥–µ—Ä, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –æ—Ç–∑—ã–≤, –≤—ã–∑–æ–≤ review, –∞–≤—Ç–æ–¥—Ä–∞—Ñ—Ç MR, email –≤–º–µ—Å—Ç–æ Slack
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Qwen Code CLI —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ Spring Boot rules
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ docker-compose –∏ Kubernetes
- –í—Å–µ —Ñ–∞–π–ª—ã Python, –∫–æ–Ω—Ñ–∏–≥, –ø—Ä–∏–º–µ—Ä—ã workflow, README, env, Dockerfile

**–î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —è —Å–µ–π—á–∞—Å –∑–∞–ø–∞–∫—É—é –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –≤ –∞—Ä—Ö–∏–≤.**

‚Äî –¢—ã –ø–æ–ª—É—á–∏—à—å –∞—Ä—Ö–∏–≤ —Å —ç—Ç–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

- README.md
- .env.example
- .gitignore
- requirements.txt
- Dockerfile
- docker-compose.yml
- /app (–≤–µ—Å—å backend)
- /.qwen-code (–≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –∫–æ–Ω—Ñ–∏–≥)
- /n8n-workflows/mr-review-workflow.json
- /k8s (deployment —Ñ–∞–π–ª—ã)
- /docs (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

–°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è, –ø–æ—è–≤–∏—Ç—Å—è —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è ‚Äî –º–æ–∂–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ/–≤ K8s.

**–î–∞–ª—å–Ω–µ–π—à–µ–µ: —Å–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –Ω—É–∂–Ω–æ–π —Å—Ä–µ–¥–µ, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã. –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ ‚Äî –¥–∞–π –∑–Ω–∞—Ç—å!**

---

# –ó–∞–≥—Ä—É–∑–∏ —Ñ–∞–π–ª—ã –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ, –ª–∏–±–æ –∏—Å–ø–æ–ª–Ω–∏ —Å–∫—Ä–∏–ø—Ç—ã –∏ –¥–∞–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –°–µ–π—á–∞—Å –æ–Ω–∏ –º–Ω–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã

–ò–∑–≤–∏–Ω–∏—Ç–µ –∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏! –Ø —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —É—Å–ø–µ–ª —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–∞–∫–æ–≤–∞—Ç—å –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –≤ –∞—Ä—Ö–∏–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.

## –ß—Ç–æ —è —É—Å–ø–µ–ª —Å–æ–∑–¥–∞—Ç—å:

–Ø –Ω–∞—á–∞–ª —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —Å —ç—Ç–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**

- ‚úÖ README.md —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- ‚úÖ .env.example —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ .gitignore
- ‚úÖ requirements.txt (–≤—Å–µ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
- ‚úÖ Dockerfile
- ‚úÖ docker-compose.yml
- ‚úÖ app/config.py (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- ‚úÖ app/models.py (Pydantic –º–æ–¥–µ–ª–∏)
- ‚úÖ app/main.py (FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
- ‚úÖ app/api/routes.py (API endpoints)

**–ß—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –¥–æ–±–∞–≤–∏—Ç—å:**

- app/services/qwen_reviewer.py (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Qwen Code CLI)
- app/services/gitlab_service.py (—Ä–∞–±–æ—Ç–∞ —Å GitLab API)
- app/services/mr_creator.py (—Å–æ–∑–¥–∞–Ω–∏–µ Fix MR)
- app/utils/validators.py (–≤–∞–ª–∏–¥–∞—Ü–∏—è MR)
- .qwen-code/config.yaml (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CLI)
- .qwen-code/java-spring-rules.yaml (–ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è Java/Spring Boot)
- k8s/*.yaml (Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã)
- n8n-workflows/mr-review-workflow.json (workflow –¥–ª—è n8n)
- docs/*.md (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)


## –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ (–∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞):

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

- GitLab Webhook ‚Üí n8n ‚Üí –í–∞–ª–∏–¥–∞—Ü–∏—è (LangChain) ‚Üí Review API ‚Üí Qwen Code CLI ‚Üí Qwen Model (vLLM)
- –°–æ–∑–¥–∞–Ω–∏–µ Fix MR –≤ –∏—Å—Ö–æ–¥–Ω—É—é feature –≤–µ—Ç–∫—É
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ Slack

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**

- Backend: FastAPI + Python 3.11
- Model: Qwen3-Coder-14B-GPTQ-Int4 —á–µ—Ä–µ–∑ vLLM
- CLI: Qwen Code CLI —Å Java/Spring Boot –ø—Ä–∞–≤–∏–ª–∞–º–∏
- Orchestration: n8n workflows
- Deploy: Docker Compose / Kubernetes

**API endpoints:**

- POST `/api/v1/review` - –ø–æ–ª–Ω—ã–π code review
- POST `/api/v1/validate-mr` - –≤–∞–ª–∏–¥–∞—Ü–∏—è MR

–ò–∑–≤–∏–Ω–∏—Ç–µ –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–æ! –†–µ–∫–æ–º–µ–Ω–¥—É—é –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç - –≤ –Ω–æ–≤–æ–º –¥–∏–∞–ª–æ–≥–µ —è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–æ–∑–¥–∞–º –ø–æ–ª–Ω—ã–π –∞—Ä—Ö–∏–≤ –ø—Ä–æ–µ–∫—Ç–∞.

