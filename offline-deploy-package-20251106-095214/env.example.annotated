# =============================================================================
# Конфигурация AI Code Review System v2.0
# =============================================================================
# Этот файл объясняет каждую переменную окружения и как она используется

# =============================================================================
# МОДЕЛЬНЫЙ API (ОБЯЗАТЕЛЬНО)
# =============================================================================
# URL OpenAI-совместимого API endpoint для LLM моделей
# Примеры:
#   - OpenAI: https://api.openai.com/v1
#   - Azure OpenAI: https://your-instance.openai.azure.com/openai/deployments/
#   - Локальный: http://localhost:11434/v1 (Ollama)
#   - vLLM: http://your-server:8000/v1
MODEL_API_URL=https://your-model-api.example.com/v1

# API ключ для аутентификации в MODEL_API_URL
# - Для OpenAI: sk-xxxxxxxxxxxxxxxxxxxx
# - Для Azure: ваш Azure API key
# - Для локального развертывания: может быть любым или пустым
MODEL_API_KEY=your-api-key-here

# =============================================================================
# МОДЕЛИ (ОБЯЗАТЕЛЬНО)
# =============================================================================
# Название модели для Cline CLI (используется с DeepSeek)
# Рекомендуется: deepseek-v3.1-terminus (лучше для code review)
# Альтернативы: deepseek-coder-33b, gpt-4, claude-3-opus
DEEPSEEK_MODEL_NAME=deepseek-v3.1-terminus

# Название модели для Qwen Code CLI
# Рекомендуется: qwen3-coder-32b (оптимизирован для кода)
# Альтернативы: qwen-coder-7b, qwen2.5-coder-32b
QWEN3_MODEL_NAME=qwen3-coder-32b

# =============================================================================
# GITLAB (ОБЯЗАТЕЛЬНО)
# =============================================================================
# URL вашего GitLab инстанса (БЕЗ trailing slash!)
# Примеры:
#   - GitLab.com: https://gitlab.com
#   - Self-hosted: https://gitlab.company.local
GITLAB_URL=https://gitlab.example.com

# GitLab Personal Access Token
# КАК ПОЛУЧИТЬ:
#   1. GitLab → Settings → Access Tokens
#   2. Создать токен с правами:
#      - read_repository (для клонирования)
#      - write_repository (для push изменений, если нужна авто-документация)
#      - api (для создания MR и комментариев)
#   3. Скопировать токен (показывается только один раз!)
# ФОРМАТ: glpat-xxxxxxxxxxxxxxxxxxxx
# ВАЖНО: Токен вставляется в Git clone URL автоматически:
#   https://oauth2:TOKEN@gitlab.example.com/repo.git
GITLAB_TOKEN=glpat-your-gitlab-token-here

# =============================================================================
# CLI КОНФИГУРАЦИЯ (ОПЦИОНАЛЬНО)
# =============================================================================
# Какой CLI агент использовать по умолчанию
# Варианты: CLINE | QWEN_CODE
# - CLINE: Лучше для комплексного анализа, использует DeepSeek
# - QWEN_CODE: Быстрее, оптимизирован для code review
DEFAULT_CLI_AGENT=CLINE

# Сколько параллельных задач может выполнять Cline
# Рекомендуется: 5 (для сервера с 16GB RAM)
# Уменьшить до 3 если мало памяти
CLINE_PARALLEL_TASKS=5

# Сколько параллельных задач может выполнять Qwen Code
# Рекомендуется: 3 (легче чем Cline)
QWEN_PARALLEL_TASKS=3

# Таймаут выполнения review (секунды)
# 300 = 5 минут (достаточно для большинства MR)
# Увеличить если большие MR (>50 файлов)
REVIEW_TIMEOUT=300

# =============================================================================
# ПРИЛОЖЕНИЕ (ОПЦИОНАЛЬНО)
# =============================================================================
# Уровень логирования
# Варианты: DEBUG | INFO | WARNING | ERROR
# DEBUG - для разработки, INFO - для production
LOG_LEVEL=INFO

# Рабочая директория для клонирования репозиториев
# В Docker: /tmp/review
# Локально: можно изменить на ./work
WORK_DIR=/tmp/review

# Путь к промптам
# Относительно корня проекта
PROMPTS_PATH=/app/prompts

# Путь к правилам по умолчанию
# Используются если не указаны кастомные правила
DEFAULT_RULES_PATH=/app/rules/java-spring-boot

# =============================================================================
# CONFLUENCE RULES (ОПЦИОНАЛЬНО)
# =============================================================================
# Загружать ли правила из Confluence
# Если true, можно хранить правила review в Confluence вместо файлов
CONFLUENCE_RULES_ENABLED=false

# URL Confluence инстанса (если CONFLUENCE_RULES_ENABLED=true)
CONFLUENCE_URL=https://confluence.example.com

# Confluence API Token (если CONFLUENCE_RULES_ENABLED=true)
# КАК ПОЛУЧИТЬ:
#   Confluence → Profile → Personal Access Tokens → Create
CONFLUENCE_API_TOKEN=

# =============================================================================
# MCP RAG (ОПЦИОНАЛЬНО, ЭКСПЕРИМЕНТАЛЬНО)
# =============================================================================
# Использовать ли MCP (Model Context Protocol) для RAG
# Позволяет CLI получать контекст из внешних источников
MCP_RAG_ENABLED=false

# URL MCP сервера (если MCP_RAG_ENABLED=true)
MCP_SERVER_URL=http://mcp-server:8080

# =============================================================================
# ЗАМЕТКИ ПО БЕЗОПАСНОСТИ
# =============================================================================
# ⚠️  ВАЖНО:
# 1. НЕ коммитить этот файл в Git после заполнения!
# 2. Добавить .env в .gitignore
# 3. Токены хранить ТОЛЬКО в .env, не в коде
# 4. Использовать secrets management в production (Vault, K8s Secrets)
# 5. Ротация токенов каждые 90 дней (best practice)

# =============================================================================
# КАК ИСПОЛЬЗОВАТЬ
# =============================================================================
# 1. Скопировать этот файл:
#    cp env.example.annotated .env
#
# 2. Заполнить обязательные параметры:
#    - MODEL_API_URL
#    - MODEL_API_KEY
#    - GITLAB_URL
#    - GITLAB_TOKEN
#
# 3. Запустить Docker:
#    docker-compose up -d
#
# 4. Проверить:
#    curl http://localhost:8000/api/v1/health

# =============================================================================
# TROUBLESHOOTING
# =============================================================================
# Если не работает:
#
# 1. GitLab connection failed:
#    - Проверить GITLAB_TOKEN: curl -H "Private-Token: TOKEN" GITLAB_URL/api/v4/user
#    - Проверить права токена (read_repository, api)
#
# 2. Model API connection failed:
#    - Проверить MODEL_API_URL доступен: curl MODEL_API_URL/models
#    - Проверить MODEL_API_KEY валиден
#
# 3. CLI not found:
#    - Войти в контейнер: docker exec -it code-review-api bash
#    - Проверить: cline --version && qwen-code --version
#
# 4. Review timeout:
#    - Увеличить REVIEW_TIMEOUT
#    - Уменьшить CLINE_PARALLEL_TASKS если мало RAM


