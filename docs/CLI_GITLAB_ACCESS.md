# –ö–∞–∫ CLI –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ GitLab

## üîë –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç

**CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ù–ï –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ GitLab –Ω–∞–ø—Ä—è–º—É—é!**

–û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å **–ª–æ–∫–∞–ª—å–Ω–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º.

---

## üîÑ –ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
                    .env —Ñ–∞–π–ª:
                    GITLAB_URL=https://gitlab.example.com
                    GITLAB_TOKEN=glpat-xxxxxxxxxxxxxxxxxxxx
                          ‚îÇ
                          ‚îÇ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (app/config.py)                          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   settings = get_settings()                                     ‚îÇ
‚îÇ   gitlab_service = GitLabService(                               ‚îÇ
‚îÇ       gitlab_url=settings.GITLAB_URL,                           ‚îÇ
‚îÇ       gitlab_token=settings.GITLAB_TOKEN                        ‚îÇ
‚îÇ   )                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚îÇ –ó–∞–ø—Ä–æ—Å –Ω–∞ review MR
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. GitLabService –ø–æ–ª—É—á–∞–µ—Ç metadata (app/services/gitlab_service.py) ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   # –ó–∞–ø—Ä–æ—Å –∫ GitLab API                                         ‚îÇ
‚îÇ   project = await gitlab_service.get_project(project_id)       ‚îÇ
‚îÇ   mr = await gitlab_service.get_merge_request(project_id, mr_iid) ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   # –§–æ—Ä–º–∏—Ä—É–µ—Ç clone URL —Å —Ç–æ–∫–µ–Ω–æ–º                               ‚îÇ
‚îÇ   clone_url = gitlab_service.get_clone_url(project)            ‚îÇ
‚îÇ   # –†–µ–∑—É–ª—å—Ç–∞—Ç:                                                  ‚îÇ
‚îÇ   # https://oauth2:glpat-xxx@gitlab.example.com/group/repo.git ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚îÇ clone_url —Å —Ç–æ–∫–µ–Ω–æ–º
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. GitRepositoryManager –∫–ª–æ–Ω–∏—Ä—É–µ—Ç (app/services/git_repository_manager.py) ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   # –í—ã–ø–æ–ª–Ω—è–µ—Ç git clone —Å URL, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º —Ç–æ–∫–µ–Ω                 ‚îÇ
‚îÇ   cmd = [                                                       ‚îÇ
‚îÇ       'git', 'clone',                                           ‚îÇ
‚îÇ       '--branch', 'feature-branch',                             ‚îÇ
‚îÇ       '--single-branch',                                        ‚îÇ
‚îÇ       clone_url,  # ‚Üê –¢–æ–∫–µ–Ω –≤–Ω—É—Ç—Ä–∏ URL!                         ‚îÇ
‚îÇ       '/tmp/review/project-123-mr-456'                          ‚îÇ
‚îÇ   ]                                                             ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   # Git CLI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏                 ‚îÇ
‚îÇ   process = await asyncio.create_subprocess_exec(*cmd)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚îÇ –õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. CLI —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (app/services/cline_cli_manager.py) ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   # CLI –ù–ï –∑–Ω–∞–µ—Ç –æ GitLab –≤–æ–æ–±—â–µ!                               ‚îÇ
‚îÇ   cmd = [                                                       ‚îÇ
‚îÇ       'cline', 'review',                                        ‚îÇ
‚îÇ       '--repo-path', '/tmp/review/project-123-mr-456',  ‚Üê –õ–æ–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å ‚îÇ
‚îÇ       '--files', 'src/Main.java,src/Service.java',             ‚îÇ
‚îÇ       '--prompt', '/tmp/prompt-12345.md',                       ‚îÇ
‚îÇ       '--model-url', 'https://model-api.com/v1',                ‚îÇ
‚îÇ       '--model', 'deepseek-v3.1-terminus',                      ‚îÇ
‚îÇ       '--api-key', 'sk-xxx'                                     ‚îÇ
‚îÇ   ]                                                             ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   # CLI —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª—ã, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–¥, –≤—ã–∑—ã–≤–∞–µ—Ç LLM             ‚îÇ
‚îÇ   # –í—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –õ–û–ö–ê–õ–¨–ù–û, –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ GitLab            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚îÇ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã review
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: Commit –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–±—Ä–∞—Ç–Ω–æ (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω auto-doc)‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   # Git CLI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç credentials –∏–∑ .git/config               ‚îÇ
‚îÇ   # (–∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã –ø—Ä–∏ clone)                           ‚îÇ
‚îÇ   await git_manager.commit_changes(repo_path, message)          ‚îÇ
‚îÇ   await git_manager.push_branch(repo_path, branch)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚îÇ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã review
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7. GitLabService —Å–æ–∑–¥–∞—ë—Ç MR/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                         ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç GitLab API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MR —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏       ‚îÇ
‚îÇ   await gitlab_service.create_merge_request(...)                ‚îÇ
‚îÇ   await gitlab_service.add_mr_comment(...)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ clone URL

### –ö–æ–¥ –≤ `app/services/gitlab_service.py` (—Å—Ç—Ä–æ–∫–∏ 232-255)

```python
def get_clone_url(self, project_data: Dict[str, Any]) -> str:
    """
    Get HTTP clone URL with authentication
    
    Args:
        project_data: Project data from get_project()
        
    Returns:
        Clone URL with token authentication
    """
    # Use http_url_to_repo and inject token
    http_url = project_data.get('http_url_to_repo', '')
    # http_url = 'https://gitlab.example.com/group/project.git'
    
    if http_url.startswith('https://'):
        parts = http_url.replace('https://', '').split('/', 1)
        # parts = ['gitlab.example.com', 'group/project.git']
        
        if len(parts) == 2:
            domain, path = parts
            # –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –≤ URL
            return f"https://oauth2:{self.headers['Private-Token']}@{domain}/{path}"
            # –†–µ–∑—É–ª—å—Ç–∞—Ç: 'https://oauth2:glpat-xxxxxxxxxxxxxxxxxxxx@gitlab.example.com/group/project.git'
    
    return http_url
```

### –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç `oauth2:TOKEN@`?

GitLab –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ HTTP –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

1. **Personal Access Token –≤ URL** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ):
   ```
   https://oauth2:TOKEN@gitlab.example.com/repo.git
   ```
   - `oauth2` - username (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
   - `TOKEN` - password (–≤–∞—à GitLab token)

2. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç**:
   ```
   https://USERNAME:TOKEN@gitlab.example.com/repo.git
   ```

3. **–ß–µ—Ä–µ–∑ Git credentials helper** (–±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ):
   ```bash
   git config credential.helper store
   # –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ ~/.git-credentials
   ```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞

### –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–∫–µ–Ω?

1. **–í .env —Ñ–∞–π–ª–µ** (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ Git):
   ```env
   GITLAB_TOKEN=glpat-xxxxxxxxxxxxxxxxxxxx
   ```

2. **–í –ø–∞–º—è—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `pydantic-settings`
   - –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç–µ `Settings`

3. **–í –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö Git**:
   - –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ URL –ø—Ä–∏ `git clone`
   - Git —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç credentials –ª–æ–∫–∞–ª—å–Ω–æ –≤ `.git/config` –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ
   - **–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ review —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–¥–∞–ª—è–µ—Ç—Å—è ‚Üí —Ç–æ–∫–µ–Ω —É–¥–∞–ª—è–µ—Ç—Å—è

### –ö–∞–∫ —Ç–æ–∫–µ–Ω –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥–∏?

```python
# –í app/services/cline_cli_manager.py (—Å—Ç—Ä–æ–∫–∞ 88)
logger.debug(f"Executing Cline CLI: {' '.join(cmd[:6])}...")  
# –õ–æ–≥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 6 –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, --api-key –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç

# –í app/services/git_repository_manager.py
# Git clone –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º URL
logger.info(f"Cloning repository to {repo_dir}")
# –ë–µ–∑ –≤—ã–≤–æ–¥–∞ clone_url!
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å?

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å GitLab Personal Access Token

1. –ó–∞–π—Ç–∏ –≤ GitLab ‚Üí **Settings** ‚Üí **Access Tokens**
2. –°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏:
   - ‚úÖ `read_repository` - –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - ‚úÖ `write_repository` - –¥–ª—è push –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ –∞–≤—Ç–æ-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
   - ‚úÖ `api` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MR –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑!)

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

```bash
# .env
GITLAB_URL=https://gitlab.example.com
GITLAB_TOKEN=glpat-xxxxxxxxxxxxxxxxxxxx

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
MODEL_API_URL=https://your-model-api.com/v1
MODEL_API_KEY=sk-xxxxx
...
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker

```bash
docker-compose up -d
```

Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` (—á–µ—Ä–µ–∑ `env_file: - .env` –≤ docker-compose.yml)

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GitLab

```bash
curl http://localhost:8000/api/v1/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "status": "healthy",
  "gitlab_connected": true,  ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å true
  "cline_available": true,
  "qwen_available": true
}
```

### –¢–µ—Å—Ç 2: –í—Ä—É—á–Ω—É—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å clone URL

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it code-review-api /bin/bash

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
git clone \
  --branch main \
  --single-branch \
  https://oauth2:YOUR_TOKEN@gitlab.example.com/group/project.git \
  /tmp/test-clone

# –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Üí —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ authentication ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –∏ –ø—Ä–∞–≤–∞
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Python

```python
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
python3 << 'EOF'
import asyncio
from app.services.gitlab_service import GitLabService
import os

async def test():
    service = GitLabService(
        gitlab_url=os.getenv("GITLAB_URL"),
        gitlab_token=os.getenv("GITLAB_TOKEN")
    )
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    connected = await service.test_connection()
    print(f"GitLab connected: {connected}")
    
    # –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
    project = await service.get_project(123)  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π project_id
    print(f"Project: {project['name']}")
    
    # –ü–æ–ª—É—á–∏—Ç—å clone URL
    clone_url = service.get_clone_url(project)
    print(f"Clone URL: {clone_url[:50]}...")  # –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é

asyncio.run(test())
EOF
```

---

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Authentication failed"

**–°–∏–º–ø—Ç–æ–º—ã:**
```
fatal: Authentication failed for 'https://gitlab.example.com/...'
```

**–ü—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è:**

1. **–¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫**
   ```bash
   # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ GitLab
   # –û–±–Ω–æ–≤–∏—Ç—å .env
   GITLAB_TOKEN=new-token-here
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
   docker-compose restart
   ```

2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ —É —Ç–æ–∫–µ–Ω–∞**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å scopes —Ç–æ–∫–µ–Ω–∞: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `read_repository`

3. **–ù–µ–≤–µ—Ä–Ω—ã–π URL GitLab**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL (–±–µ–∑ trailing slash)
   GITLAB_URL=https://gitlab.example.com  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
   GITLAB_URL=https://gitlab.example.com/ # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Repository not found"

**–°–∏–º–ø—Ç–æ–º—ã:**
```
fatal: repository 'https://gitlab.example.com/...' not found
```

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, —Ç–æ–∫–µ–Ω—É –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
2. Project ID –Ω–µ–≤–µ—Ä–Ω—ã–π
3. URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API
curl -H "Private-Token: YOUR_TOKEN" \
  https://gitlab.example.com/api/v4/projects/123

# –ï—Å–ª–∏ 200 OK ‚Üí –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å
# –ï—Å–ª–∏ 404 ‚Üí –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π ID
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: CLI –Ω–µ –≤–∏–¥—è—Ç —Ñ–∞–π–ª—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Error: No files to review
```

**–ü—Ä–∏—á–∏–Ω–∞:** –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω, –Ω–æ CLI –Ω–µ –ø–æ–ª—É—á–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
docker-compose logs review-api | grep "repo_path"
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –ø—É—Ç—å —Ç–∏–ø–∞ /tmp/review/project-123-mr-456
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [app/config.py](../app/config.py) - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [app/services/gitlab_service.py](../app/services/gitlab_service.py) - GitLab API
- [app/services/git_repository_manager.py](../app/services/git_repository_manager.py) - Git –æ–ø–µ—Ä–∞—Ü–∏–∏
- [app/services/cline_cli_manager.py](../app/services/cline_cli_manager.py) - Cline CLI

---

## üéØ –ò—Ç–æ–≥–æ

**CLI –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ GitLab!**

–î–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:
1. ‚úÖ FastAPI –ø–æ–ª—É—á–∞–µ—Ç GitLab token –∏–∑ `.env`
2. ‚úÖ GitLabService —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç clone URL —Å —Ç–æ–∫–µ–Ω–æ–º
3. ‚úÖ Git CLI –∫–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —ç—Ç–∏–º URL
4. ‚úÖ CLI —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (–∏–º GitLab –Ω–µ –Ω—É–∂–µ–Ω!)

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π `GITLAB_TOKEN` –≤ `.env` —Ñ–∞–π–ª–µ.

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-11-03  
**–í–µ—Ä—Å–∏—è:** 1.0.0


